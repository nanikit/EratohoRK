
;------------------------------------------------------------------------
;EDIT	001		KOremi			2011/11/04		전체의 고쳐 써, 정렬
;												ACT_APPLY_PROCESS.ERB로부터 지문을 자른다
;												강제탈의, 자주탈의 처리를 조정
;------------------------------------------------------------------------

;────────────────────────────────────
;거절시 지문(리액션에 의해 조교가 캔슬된다)
;────────────────────────────────────

;────────────────────────────────────
;성교의 캔슬
;────────────────────────────────────
@CANCEL_INSERT_TO_M_MESSAGE
PRINTL 
;성교 개시시
IF TFLAG:ACT분류 == 3
	PRINTFORML %CALLNAME:TARGET%는%CALLNAME:MASTER%와 성교하려고 했지만,%CALLNAME:MASTER%가 날뛰어 잘 되지 않았다…
;성교중
ELSE
	PRINTFORML %CALLNAME:TARGET%는%CALLNAME:MASTER%에 삽입하고 있었지만,%CALLNAME:MASTER%가 날뛰었으므로 일단 그만둘 수 밖에 없었다…
ENDIF
RETURN 1
;────────────────────────────────────
;성교 봉사의 캔슬
;────────────────────────────────────
@CANCEL_INSERT_TO_T_MESSAGE
PRINTL 
;성교 개시시
IF TFLAG:ACT분류 == 10
	;ACT가애널섹스시킨다라면
	IF IS_NOWACTNAME("애널섹스시킨다")
		PRINTFORML %CALLNAME:TARGET%는%CALLNAME:MASTER%의\@ TEQUIP:페니스밴드 ? 의욕형 # 페니스 \@를 아누스에 삽입 시키려고 했지만,%CALLNAME:MASTER%가 날뛰어 잘 되지 않았다…
	;그 외
	ELSE
		PRINTFORML %CALLNAME:TARGET%는%CALLNAME:MASTER%의\@ TEQUIP:페니스밴드 ? 의욕형 # 페니스 \@를 바기나에 삽입 시키려고 했지만,%CALLNAME:MASTER%가 날뛰었으므로 일단 그만둘 수 밖에 없었다…
	ENDIF
;성교중
ELSE
	;애널섹스 상태이면
	IF TEQUIP:성교봉사중 == 6
		PRINTFORML %CALLNAME:MASTER%가 날뛰었기 때문에,%CALLNAME:TARGET%의 아누스에 삽입되고 있었다\@ TEQUIP:페니스밴드 ? 의욕형 # 페니스 \@가 빠져 버렸다…
	;그 외
	ELSE
		PRINTFORML %CALLNAME:MASTER%가 날뛰었기 때문에,%CALLNAME:TARGET%에 삽입되고 있었다\@ TEQUIP:페니스밴드 ? 의욕형 # 페니스 \@가 빠져 버렸다…
	ENDIF
ENDIF
RETURN 1
;────────────────────────────────────
;가학, 노출 플레이의 캔슬（상해, 구속, 노출, 일탈）
;────────────────────────────────────
;구속 캔슬
@CANCEL_TEQUIP_RESTRAINT_MESSAGE
PRINTL 
PRINTFORML %CALLNAME:MASTER%의 애원을 들어주어,%CALLNAME:TARGET%는%CALLNAME:MASTER%의 구속을 풀었다…
RETURN 1
;삼각목마 캔슬
@CANCEL_TEQUIP_W_HORSE_MESSAGE
PRINTL 
PRINTFORML %CALLNAME:MASTER%의 애원을 들어주어,%CALLNAME:TARGET%는%CALLNAME:MASTER%를 목마로부터 내렸다…
RETURN 1
;야외플레이 캔슬
@CANCEL_TEQUIP_OUTDOOR_MESSAGE
PRINTL 
PRINTFORML %CALLNAME:MASTER%의 애원을 들어주어,%CALLNAME:TARGET%는%CALLNAME:MASTER%를 따라 방으로 돌아왔다…
RETURN 1
;대거울 캔슬
@CANCEL_TEQUIP_MIRROR_MESSAGE
PRINTL 
PRINTFORML %CALLNAME:MASTER%의 애원을 들어주어,%CALLNAME:TARGET%는%CALLNAME:MASTER%를 따라 거울의 전부터 떨어졌다…
RETURN 1
;코스프레 캔슬
@CANCEL_TEQUIP_COSPLAY_MESSAGE
PRINTL 
PRINTFORML %CALLNAME:MASTER%의 애원을 들어주어,%CALLNAME:TARGET%는%CALLNAME:MASTER%의 갈아입음을 허락해, 코스프레 의상을 회수했다…
RETURN 1

;────────────────────────────────────
;특수 상황시 지문(특별한 상황이 일어났을 때의 지문)
;────────────────────────────────────

;────────────────────────────────────
;자위절정시의 지문 표시
;────────────────────────────────────
@ONANIE_EX_MESSAGE
;ACT가 자위의 경우 내용이 입으므로 표시하지 않는다
SIF TFLAG:ACT == GET_ACTNUM("자위")
	RETURN 0
;페니스 있어
IF PENIS(MASTER)
	;REACT분류가 적극적 따르는 계
	IF IS_COMGRONAME("적극적으로 한다")
		;얼굴에 사정하기 자위절정
		IF ME_PLAYER(1) == 9
			PRINTFORML %CALLNAME:MASTER%가 자신의 음경을 훑어 내면서 사정이 가까운 것을 전하면,
			PRINTFORML %CALLNAME:TARGET%는 령구의 앞에서 혀응과 내밀어, 입의 안까지 날리도록(듯이) 명령했다…
		;그 외
		ELSE
			PRINTFORML %CALLNAME:MASTER%가 자신의 음경을 훑어 내면서 사정이 가까운 것을 전하면,
			PRINTFORML %CALLNAME:TARGET%는 추잡한 말을 속삭이면서 혼자서 가도록(듯이) 명했다…
		ENDIF
	;REACT분류가 그 외
	ELSE
		;얼굴에 사정하기 자위절정
		IF ME_PLAYER(1) == 9
			PRINTFORML %CALLNAME:TARGET%는 자신의 음경을 훑고 있다%CALLNAME:MASTER%의 절정을 헤아리면
			PRINTFORML 령구의 앞에서 혀응과 내밀어, 입의 안까지 날리도록(듯이) 명령했다…
		;그 외
		ELSE
			PRINTFORML %CALLNAME:TARGET%는 자신의 음경을 훑고 있다%CALLNAME:MASTER%의 절정을 헤아리면
			PRINTFORML 추잡한 말을 속삭이면서 혼자서 가도록(듯이) 명했다…
		ENDIF
	ENDIF
ELSE
	;REACT분류가 적극적 따르는 계
	IF IS_COMGRONAME("적극적으로 한다")
		PRINTFORML %CALLNAME:MASTER%가 자신의 음핵을 뭉그러뜨리면서 절정이 가까운 것을 전하면,
		PRINTFORML %CALLNAME:TARGET%는 추잡한 말을 속삭이면서 혼자서 가도록(듯이) 명했다…
	;REACT분류가 그 외
	ELSE
		PRINTFORML %CALLNAME:TARGET%는 자신의 음핵을 만지작거리고 있다%CALLNAME:MASTER%의 절정을 헤아리면
		PRINTFORML 추잡한 말을 속삭이면서 혼자서 가도록(듯이) 명했다…
	ENDIF
ENDIF
RETURN 1

;────────────────────────────────────
;실행시 지문(ACT종에 의하지 않는 지문)
;────────────────────────────────────

;────────────────────────────────────
;미약·로션 사용시의 지문/구상 표시
;────────────────────────────────────
@USE_MESSAGE
;미약·로션을 사용한 취지의 메세지를 표시합니다
;여기의 개행 처리는 이상하기 때문에 다음에 여러 가지 조정이 필요

;RESULT 초기화
RESULT = 0

;미약등사용구상 호출
IF TFLAG:미약등사용구상 && ((ASSI:1) < 0 || TCVAR:(ASSI:1):조수ACT != 71)
	PRINTL 
	CALL KOJO_USE
ENDIF

;구상 표시 우시로지의 문장을 표시하는 경우
SIF RESULT && TFLAG:미약등사용지문스킵
	PRINTL 
;지문 표시 종별에 의해 분기
SELECTCASE TFLAG:미약등사용지문스킵
	;로션
	CASE 1
		;조수 협력시
		IF (ASSI:1) >= 0 && TCVAR:(ASSI:1):조수ACT == 71
			ALIGNMENT RIGHT
			PRINTFORML %CALLNAME:(ASSI:1)%는%CALLNAME:MASTER%의 몸에 로션을 발랐다…
			ALIGNMENT LEFT
		;조수비협력시
		ELSE
			PRINTFORML %CALLNAME:TARGET%는%CALLNAME:MASTER%의 몸에 로션을 발랐다…
		ENDIF
	;미약
	CASE 2
		;조수 협력시
		IF (ASSI:1) >= 0 && TCVAR:(ASSI:1):조수ACT == 71
			ALIGNMENT RIGHT
			PRINTFORML %CALLNAME:(ASSI:1)%는%CALLNAME:MASTER%에 미약을 사용했다…
			ALIGNMENT LEFT
		;키스시
		ELSEIF IS_NOWACTNAME("키스")
			PRINTFORML %CALLNAME:TARGET%는 스스로 미약을 마셔, 키스 하면서 그것을 입으로 옮김으로%CALLNAME:MASTER%에 먹였다…
		;조수비협력시
		ELSE
			PRINTFORML %CALLNAME:TARGET%는%CALLNAME:MASTER%에 미약을 사용했다…
		ENDIF
	;로션＆미약
	CASE 3
		;조수 협력시
		IF (ASSI:1) >= 0 && TCVAR:(ASSI:1):조수ACT == 71
			ALIGNMENT RIGHT
			PRINTFORML %CALLNAME:(ASSI:1)%는%CALLNAME:MASTER%에 미약을 사용했다…
			PRINTFORML 한층 더%CALLNAME:(ASSI:1)%는 달아오른다%CALLNAME:MASTER%의 몸에 로션을 발랐다…
			ALIGNMENT LEFT
		;키스시
		ELSEIF IS_NOWACTNAME("키스")
			PRINTFORML %CALLNAME:TARGET%는 스스로 미약을 마셔, 키스 하면서 그것을 입으로 옮김으로%CALLNAME:MASTER%에 먹였다…
			PRINTFORML 한층 더 입맞춤한 채로 달아오른다%CALLNAME:MASTER%의 몸에 로션을 발랐다…
		;조수비협력시
		ELSE
			PRINTFORML %CALLNAME:TARGET%는%CALLNAME:MASTER%에 미약을 사용했다…
			PRINTFORML 한층 더%CALLNAME:TARGET%는 달아오른다%CALLNAME:MASTER%의 몸에 로션을 발랐다…
		ENDIF
ENDSELECT
WAIT

;-----------EDIT 001 START--------------
;주로 인수에 의해 판정하는 방식으로 변경
;---------------------------------------
;────────────────────────────────────
;강제탈의, 자주탈의시의 지문/구상 표시
;────────────────────────────────────
;강제탈의·자주탈의의 메세지를 표시합니다

;탈의 직전에서의 지문/구상
@DATUI_MESSAGE(ARG, ARG:1)

;탈의전에 복장을 보존한다(탈의 직후에서의 지문으로 이용)
CALLF CLOTHE_SAVE(TARGET)
CALLF CLOTHE_SAVE(MASTER)

;조수가 탈의의 심부름을 하는 경우
IF NOWASSIACTNAME(ASSI:1) == "탈의"
	ALIGNMENT RIGHT
	PRINTFORML %CALLNAME:(ASSI:1)%는 돌연,%CALLNAME:MASTER%의 옷에 손을 대었다…
	ALIGNMENT LEFT
	;조교자 탈의도 발생
	SIF ARG:1 > 0
		PRINTFORML %CALLNAME:TARGET%도 자신의 의복에 손을 대어, 벗기 시작했다…
	WAIT
;조교 대상, 조교자 모두 탈의
ELSEIF ARG > 0 && ARG:1 > 0
	PRINTFORMW %CALLNAME:TARGET%는%CALLNAME:MASTER%와 자신의 옷에 손을 대었다…
;조교 대상 탈의
ELSEIF ARG > 0
	PRINTFORMW %CALLNAME:TARGET%는 돌연,%CALLNAME:MASTER%의 옷에 손을 대었다…
;조교자 탈의
ELSEIF ARG:1 > 0
	PRINTFORMW %CALLNAME:TARGET%는 자신의 의복에 손을 대어, 벗기 시작했다…
ENDIF

;RESULT 초기화
RESULT = 0
;탈의시 구상 호출
CALL KOJO_DATUI

;조교 대상 탈의 실패
IF TFLAG:강제탈의 < 0
	PRINTFORML %CALLNAME:TARGET%는%CALLNAME:MASTER%의 옷을 벗기려고 했지만,%CALLNAME:MASTER%에 방해받았다…
;조교 대상 탈의 성공
ELSEIF ARG > 0
	;LOCAL 초기화
	VARSET LOCAL
	;조수가 탈의의 심부름을 하는 경우
	IF NOWASSIACTNAME(ASSI:1) == "탈의"
		;조교자 탈의도 발생
		SIF ARG:1 > 0
			ALIGNMENT RIGHT
		PRINTFORM %CALLNAME:(ASSI:1)%\@ ARG:1 > 0 ? 가 # 는 \@%CALLNAME:MASTER%의
	;조수가 탈의의 심부름을 하지 않는 경우
	ELSE
		PRINTFORM %CALLNAME:TARGET%는%CALLNAME:MASTER%의
	ENDIF
	;탈의 매수 확인(LOCAL:1에 탈의 매수를 대입)
	FOR LOCAL, 0, 7
		SIF GETBIT(ARG, LOCAL)
			LOCAL:1 ++
	NEXT
	;최종 착의 매수 확인(LOCAL:2에 최종 착의 매수를 대입)
	FOR LOCAL, 0, 7
		SIF TEQUIP:MASTER:LOCAL != 0 && !GETBIT(ARG, LOCAL)
			LOCAL:2 ++
	NEXT
	;최종 착의가전라라면
	IF LOCAL:2 == 0
		;탈의 매수가 3매 이상
		IF LOCAL:1 > 2
			PRINT 감기는 의상을 모두
		;탈의 매수가 2매
		ELSEIF LOCAL:1 == 2
			PRINTFORM 의류 모든 것을
		;탈의 매수가 1매(탈의측을 표시)
		ELSE
			CALL DATUI_MESSAGE_SORT(0, ARG, MASTER)
		ENDIF
	;속옷만 탈의시, 잔착의 있어
	ELSEIF !(ARG & ~12) && (LOCAL:2 >= 0)
		;하반신, 상반신윗도리
		IF TEQUIP:MASTER:하반신윗도리 && TEQUIP:MASTER:상반신윗도리
			PRINTFORM %OUTER_T(MASTER, 0, 1)%와%OUTER_B(MASTER, 0, 1)%를 남겨 속옷만
		;하반신윗도리
		ELSEIF TEQUIP:MASTER:하반신윗도리
			PRINTFORM %OUTER_B(MASTER, 0, 1)%를 남겨 속옷만
		;상반신, 전신윗도리
		ELSEIF TEQUIP:MASTER:상반신윗도리 || TEQUIP:MASTER:전신윗도리
			PRINTFORM %OUTER_T(MASTER, 0, 1)%를 남겨 속옷만
		;다른 한쪽의 속옷만 탈의(탈의측을 표시)
		ELSEIF LOCAL:1 == 1
			CALL DATUI_MESSAGE_SORT(0, ARG, MASTER)
		;그 외
		ELSE
			PRINTFORM 속옷 모든 것을
		ENDIF
	;최종 착의가전라 이외라면
	ELSE
		;탈의 매수가 최종 착의 이하라면 탈의측을 표시
		IF LOCAL:1 <= LOCAL:2
			CALL DATUI_MESSAGE_SORT(0, ARG, MASTER)
		;그렇지 않으면 착의측을 표시
		ELSE
			CALL DATUI_MESSAGE_SORT(1, ARG, MASTER)
		ENDIF
	ENDIF
	;벗은 결과전라
	IF LOCAL:2 == 0
		PRINTFORML 억지로\@ ARG:1 > 0 ? 벗겨전라로 하면,  # 벗겨, 전라로 한… \@
	;벗은 결과전라 이외
	ELSE
		PRINTFORML 억지로\@ ARG:1 > 0 ? 벗기면,  # 벗긴… \@
	ENDIF
	ALIGNMENT LEFT
ENDIF
;조교자 탈의 발생
IF ARG:1 > 0
	;LOCAL 초기화
	VARSET LOCAL
	;조교 대상 탈의 실패시
	IF TFLAG:강제탈의 < 0
		PRINTFORM %CALLNAME:TARGET%는 단념해 자신의
	;조수가 탈의의 심부름을 하는 경우
	ELSEIF NOWASSIACTNAME(ASSI:1) == "탈의"
		PRINTFORM %CALLNAME:TARGET%도 자신의
	;조교 대상 탈의 성공시
	ELSEIF ARG > 0
		PRINT 자신도
	;조교 대상 탈의 불발생시
	ELSE
		PRINTFORM %CALLNAME:TARGET%는 자신의
	ENDIF
	;탈의 매수 확인(LOCAL:1에 탈의 매수를 대입)
	FOR LOCAL, 0, 7
		SIF GETBIT(ARG:1, LOCAL)
			LOCAL:1 ++
	NEXT
	;최종 착의 매수 확인(LOCAL:2에 최종 착의 매수를 대입)
	FOR LOCAL, 0, 7
		SIF TEQUIP:LOCAL != 0 && !GETBIT(ARG:1, LOCAL)
			LOCAL:2 ++
	NEXT
	;최종 착의가전라라면
	IF LOCAL:2 == 0
		;탈의 매수가 3매 이상
		IF LOCAL:1 > 2
			PRINT 감기는 의상을 모두
		;탈의 매수가 2매
		ELSEIF LOCAL:1 == 2
			PRINTFORM 의류 모든 것을
		;탈의 매수가 1매(탈의측을 표시)
		ELSE
			CALL DATUI_MESSAGE_SORT(0, ARG:1, TARGET)
		ENDIF
	;속옷만 탈의시, 잔착의 있어
	ELSEIF !(ARG:1 & ~12) && (LOCAL:2 >= 0)
		;하반신, 상반신윗도리
		IF TEQUIP:하반신윗도리 && TEQUIP:상반신윗도리
			PRINTFORM %OUTER_T(TARGET, 0, 1)%와%OUTER_B(TARGET, 0, 1)%를 남겨 속옷만
		;하반신윗도리
		ELSEIF TEQUIP:하반신윗도리
			PRINTFORM %OUTER_B(TARGET, 0, 1)%를 남겨 속옷만
		;상반신, 전신윗도리
		ELSEIF TEQUIP:상반신윗도리 || TEQUIP:전신윗도리
			PRINTFORM %OUTER_T(TARGET, 0, 1)%를 남겨 속옷만
		;다른 한쪽의 속옷만 탈의(탈의측을 표시)
		ELSEIF LOCAL:1 == 1
			CALL DATUI_MESSAGE_SORT(0, ARG:1, TARGET)
		;그 외
		ELSE
			PRINTFORM 속옷 모든 것을
		ENDIF
	;최종 착의가전라 이외라면
	ELSE
		;탈의 매수가 최종 착의 이하라면 탈의측을 표시
		IF LOCAL:1 <= LOCAL:2
			CALL DATUI_MESSAGE_SORT(0, ARG:1, TARGET)
		;그렇지 않으면 착의측을 표시
		ELSE
			CALL DATUI_MESSAGE_SORT(1, ARG:1, TARGET)
		ENDIF
	ENDIF
	;벗은 결과전라
	IF LOCAL:2 == 0
		PRINTFORML 벗어, 전라가 되었다…
	;벗은 결과전라 이외
	ELSE
		PRINTFORML 벗어 던졌다…
	ENDIF
ENDIF
;조교 대상 탈의 실패시
SIF TFLAG:강제탈의 < 0
	PRINTFORML %CALLNAME:TARGET%는 꽤 화나 있는 것 같다…
WAIT

RETURN RESULT

;탈의 직후에서의 지문/구상
@DATUI_MESSAGE2(ARG, ARG:1)
PRINTL 
;조교 대상, 조교자 탈의시 결과를 표시
SIF ARG > 0
	CALL CLOTHE_SHOW(MASTER)
SIF ARG:1 > 0
	CALL CLOTHE_SHOW(TARGET)
SIF  ARG > 0 || ARG:1 > 0
	WAIT

@DATUI_MESSAGE_SORT(ARG, ARG:1, ARG:2)
;탈의(최종 착의) 종을 외측으로부터 순서에 표시
;ARG:0	0 =탈의종  1 =최종 착의종
;ARG:1	탈의 지정 부위
;ARG:2	대상자

;LOCAL 초기화
VARSET LOCAL

;외측의 착의로부터 확인
LOCAL = 6
;엔들레스 루프
WHILE 1
	;확인 착의를 탈의(착의) 하고 있었을 경우
	IF  TEQUIP:(ARG:2):LOCAL != 0 && !ARG == GETBIT(ARG:1, LOCAL)
		;2번째 이후는 이음어도 표시
		SIF LOCAL:1
			PRINT 와
		;탈의(착의) 내용을 표시
		PRINTS CLOTHES(LOCAL, ARG:2)
		;표시수카운트
		LOCAL:1++
	ENDIF
	;확인하는 부위가 없으면 탈출
	SIF LOCAL == 0
		BREAK
	;확인 착의를 안쪽에 쉬프트
	LOCAL--
WEND
;탈의종 표시시
IF ARG == 0
	PRINT 를
;최종 착의종 표시시
ELSE
	PRINT 이외의 의상 모두를
ENDIF
;-----------EDIT 001 END  --------------
