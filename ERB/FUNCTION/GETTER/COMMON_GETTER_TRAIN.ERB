;==================================================
;
;	범용 함수 두는 곳＠참조편
;		참조에 이용해 특정의 수치나 명칭 따위를 돌려주는 것
;		혹은, 상황에 따른 접두어 따위를 돌려주는 것
;
;		구상전용의 것도 있거나 않기도 하고.
;
;==================================================

;==================================================
;
;	ACT·COM 관련의 참조
;
;==================================================

;-------------------------------------------------
;명칭·번호 대응계(구명칭에서의 호출도 가능)
;
;00LIST        대응 관계 리스트를 돌려준다
;GET_00NAME    번호로부터 명칭을 돌려준다
;GET_00NUM     명칭으로부터 번호를 돌려준다
;NOW 00NAME     현재의 명칭을 돌려준다
;IS_NOW 00NAME  현재의 명칭과 합치하면 진을 돌려준다
;PREV 00NAME    전회의 명칭을 돌려준다
;IS_PREV 00NAME 전회의 명칭과 합치하면 진을 돌려준다
;-------------------------------------------------

;-------------------------------------------------
;MENU(조교 유별)
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@MENULIST()
#FUNCTIONS
RETURNF "회화/애무/도구/성교/수치/봉사/가학/이상/사역/휴게/성적봉사"

;번호로부터 명칭을 돌려준다
@GET_MENUNAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, MENULIST())

@MENU(ARG)
#FUNCTIONS
RETURNF GET_MENUNAME(ARG)

;명칭으로부터 번호를 돌려준다
@GET_MENUNUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, MENULIST())

@MENUNUM(ARGS)
#FUNCTION
RETURNF GET_MENUNUM(ARGS)

;현재의 명칭을 돌려준다
@NOWMENUNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:ACT분류, MENULIST())

;현재의 명칭과 합치하면 진을 돌려준다
@IS_NOWMENUNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, MENULIST(), TFLAG:ACT분류)

;전회의 명칭을 돌려준다
@PREVMENUNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:전ACT분류, MENULIST())

;전회의 명칭과 합치하면 진을 돌려준다
@IS_PREVMENUNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, MENULIST(), TFLAG:전ACT분류)

;-------------------------------------------------
;ACT(조교자 행동)
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@ACTLIST()
#FUNCTIONS
IF LOCALS == ""
	FOR LOCAL, 0, 800
		LOCALS += STR:LOCAL
		LOCALS += "/"
	NEXT
ENDIF
RETURNF LOCALS

;번호로부터 명칭을 돌려준다
@GET_ACTNAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, ACTLIST())

;명칭으로부터 번호를 돌려준다
@GET_ACTNUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, ACTLIST())

;현재의 명칭을 돌려준다
@NOWACTNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:ACT, ACTLIST())

;현재의 명칭과 합치하면 진을 돌려준다
@IS_NOWACTNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, ACTLIST(), TFLAG:ACT)

;전회의 명칭을 돌려준다
@PREVACTNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:전ACT, ACTLIST())

;전회의 명칭과 합치하면 진을 돌려준다
@IS_PREVACTNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, ACTLIST(), TFLAG:전ACT)

;-------------------------------------------------
;ACTABB(조교자 행동 약칭)
;※ACT 약칭은 전각 2문자(반각 4문자)에 통일했다@이것 보고
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@ACTABBLIST()
#FUNCTIONS
IF LOCALS == ""
	LOCALS += "기분/호의/지식/농락해라/위협한다/의상/합의/징계/로명/비웃는다/"
	LOCALS += "손으로/가슴을/입으로/A손/A구/키스/C찰/B찰/다리로/V손/"
	LOCALS += "로터/바이/A바이/A비/C사랑/니풀/P대/압도///"
	LOCALS += "정상/후배/승마/대면/배면 /AS/////"
	LOCALS += "자위/개장/보이고/대거울/야외/방뇨/코스////"
	LOCALS += "손으로/입으로/가슴으로/가랑이//족지/이라/가슴을///"
	LOCALS += "손바닥/회초리/바늘/줄/눈가림/입마개/매도/목마/관장//"
	LOCALS += "Fist/AFi/양Fi/방치/공중/P장/////"
	LOCALS += "촉수//////////"
	LOCALS += "휴일/복약/치료///M정/M 후/M대/M키/MAS/"
	LOCALS += "///M기"
ENDIF
RETURNF LOCALS

;번호로부터 명칭을 돌려준다
@GET_ACTABBNAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, ACTABBLIST())

;명칭으로부터 번호를 돌려준다
@GET_ACTABBNUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, ACTABBLIST())

;현재의 명칭을 돌려준다
@NOWACTABBNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:ACT, ACTABBLIST())

;현재의 명칭과 합치하면 진을 돌려준다
@IS_NOWACTABBNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, ACTABBLIST(), TFLAG:ACT)

;전회의 명칭을 돌려준다
@PREVACTABBNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:전ACT, ACTABBLIST())

;전회의 명칭과 합치하면 진을 돌려준다
@IS_PREVACTABBNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, ACTABBLIST(), TFLAG:전ACT)

;-------------------------------------------------
;ASSIMENU(조수방침)
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@ASSIMENULIST()
#FUNCTIONS
RETURNF "콤비 네이션/C애무/A애무/B애무/V애무/M애무/수치/가학/그 외"

;번호로부터 명칭을 돌려준다
@GET_ASSIMENUNAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, ASSIMENULIST())

;명칭으로부터 번호를 돌려준다
@GET_ASSIMENUNUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, ASSIMENULIST())

;ARG로 조수 번호를 지정
;인수를 생략 했을 경우는 ASSI를 본다…
;가 아무튼 여기는 기본적으로 인수 넣어 사용해 주세요

;현재의 명칭을 돌려준다
@NOWASSIMENUNAME(ARG = -99)
#FUNCTIONS
ARG = ASSI_ARG_SET(ARG, "NOWASSIMENUNAME")
SIF ARG < 0
	RETURNF ""
RETURNF GET_NAME_LIST(TCVAR:ARG:조수ACT, ASSIMENULIST())

;현재의 명칭과 합치하면 진을 돌려준다
@IS_NOWASSIMENUNAME(ARG = -99, ARGS)
#FUNCTION
ARG = ASSI_ARG_SET(ARG, "IS_NOWASSIMENUNAME")
SIF ARG < 0
	RETURNF 0
RETURNF IS_LIST(ARGS, ASSIMENULIST(), TCVAR:ARG:조수ACT)

;전회의 명칭을 돌려준다
@PREVASSIMENUNAME(ARG = -99)
#FUNCTIONS
ARG = ASSI_ARG_SET(ARG, "PREVASSIMENUNAME")
SIF ARG < 0
	RETURNF ""
RETURNF GET_NAME_LIST(TCVAR:ARG:조수전ACT, ASSIMENULIST())

;전회의 명칭과 합치하면 진을 돌려준다
@IS_PREVASSIMENUNAME(ARG = -99, ARGS)
#FUNCTION
ARG = ASSI_ARG_SET(ARG, "IS_PREVASSIMENUNAME")
SIF ARG < 0
	RETURNF 0
RETURNF IS_LIST(ARGS, ASSIMENULIST(), TCVAR:ARG:조수전ACT)

;-------------------------------------------------
;ASSIACT(조수 행동)
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@ASSIACTLIST()
#FUNCTIONS
IF LOCALS == ""
	FOR LOCAL, 800, 1000
		LOCALS += STR:LOCAL
		LOCALS += "/"
	NEXT
ENDIF
RETURNF LOCALS

;번호로부터 명칭을 돌려준다
@GET_ASSIACTNAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, ASSIACTLIST())

;명칭으로부터 번호를 돌려준다
@GET_ASSIACTNUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, ASSIACTLIST())

;ARG로 조수 번호를 지정
;인수를 생략 했을 경우는 ASSI를 본다…
;가 아무튼 여기는 기본적으로 인수 넣어 사용해 주세요

;현재의 명칭을 돌려준다
@NOWASSIACTNAME(ARG = -99)
#FUNCTIONS
ARG = ASSI_ARG_SET(ARG, "NOWASSIACTNAME")
SIF ARG < 0
	RETURNF ""
RETURNF GET_NAME_LIST(TCVAR:ARG:조수ACT, ASSIACTLIST())

;현재의 명칭과 합치하면 진을 돌려준다
@IS_NOWASSIACTNAME(ARG = -99, ARGS)
#FUNCTION
ARG = ASSI_ARG_SET(ARG, "IS_NOWASSIACTNAME")
SIF ARG < 0
	RETURNF 0
RETURNF IS_LIST(ARGS, ASSIACTLIST(), TCVAR:ARG:조수ACT)

;전회의 명칭을 돌려준다
@PREVASSIACTNAME(ARG = -99)
#FUNCTIONS
ARG = ASSI_ARG_SET(ARG, "PREVASSIACTNAME")
SIF ARG < 0
	RETURNF ""
RETURNF GET_NAME_LIST(TCVAR:ARG:조수전ACT, ASSIACTLIST())

;전회의 명칭과 합치하면 진을 돌려준다
@IS_PREVASSIACTNAME(ARG = -99, ARGS)
#FUNCTION
ARG = ASSI_ARG_SET(ARG, "IS_PREVASSIACTNAME")
SIF ARG < 0
	RETURNF 0
RETURNF IS_LIST(ARGS, ASSIACTLIST(), TCVAR:ARG:조수전ACT)

;-------------------------------------------------
;COMGRO(조교 대상 행동 분류)
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@COMGROLIST()
#FUNCTIONS
RETURNF "없음/소극적 따른다/태연하게 따른다/적극적 따른다/받아들인다/용서를빈다/날뛴다/거부/도망친다"

;번호로부터 명칭을 돌려준다
@GET_COMGRONAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, COMGROLIST())

@COMGRONAME(ARG)
#FUNCTIONS
RETURNF GET_COMGRONAME(ARG)

;명칭으로부터 번호를 돌려준다
@GET_COMGRONUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, COMGROLIST())

@COMGRONUM(ARGS)
#FUNCTION
RETURNF GET_COMGRONUM(ARGS)

;현재의 명칭을 돌려준다
@NOWCOMGRONAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:REACT분류, COMGROLIST())

;현재의 명칭과 합치하면 진을 돌려준다
@IS_NOWCOMGRONAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, COMGROLIST(), TFLAG:REACT분류)

@IS_COMGRONAME(ARGS)
#FUNCTION
RETURNF IS_NOWCOMGRONAME(ARGS)

;전회의 명칭을 돌려준다
@PREVCOMGRONAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:전REACT분류, COMGROLIST())

;전회의 명칭과 합치하면 진을 돌려준다
@IS_PREVCOMGRONAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, COMGROLIST(), TFLAG:전REACT분류)

;-------------------------------------------------
;COMIMP(REACT인상)
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@COMIMPLIST()
#FUNCTIONS
RETURNF "영향없음/좋은인상/약간좋은인상/나쁜인상/약간나쁜인상/0에서멀어짐/0에가까워짐"

;번호로부터 명칭을 돌려준다
@GET_COMIMPNAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, COMIMPLIST())

@COMIMPNAME(ARG)
#FUNCTIONS
RETURNF GET_COMIMPNAME(ARG)

;명칭으로부터 번호를 돌려준다
@GET_COMIMPNUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, COMIMPLIST())

@COMIMPNUM(ARGS)
#FUNCTION
RETURNF GET_COMIMPNUM(ARGS)

;현재의 명칭을 돌려준다
@NOWCOMIMPNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(TFLAG:REACT인상, COMIMPLIST())

;현재의 명칭과 합치하면 진을 돌려준다
@IS_NOWCOMIMPNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, COMIMPLIST(), TFLAG:REACT인상)

@IS_COMIMPNAME(ARGS)
#FUNCTION
RETURNF IS_NOWCOMIMPNAME(ARGS)

;-------------------------------------------------
;COM(조교 대상 행동)
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@COMLIST()
#FUNCTIONS
IF LOCALS == ""
	FOR LOCAL, 0, 100
		LOCALS += TRAINNAME:LOCAL
		LOCALS += "/"
	NEXT
ENDIF
RETURNF LOCALS

;번호로부터 명칭을 돌려준다
@GET_COMNAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, COMLIST())

;명칭으로부터 번호를 돌려준다
@GET_COMNUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, COMLIST())

;현재의 명칭을 돌려준다
;TRAINNAME:SELECTCOM에서도 가능
@NOWCOMNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(SELECTCOM, COMLIST())

;현재의 명칭과 합치하면 진을 돌려준다
@IS_NOWCOMNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, COMLIST(), SELECTCOM)

;전회의 명칭을 돌려준다
;TRAINNAME:PREVCOM에서도 가능
@PREVCOMNAME()
#FUNCTIONS
RETURNF GET_NAME_LIST(PREVCOM, COMLIST())

;전회의 명칭과 합치하면 진을 돌려준다
@IS_PREVCOMNAME(ARGS)
#FUNCTION
RETURNF IS_LIST(ARGS, COMLIST(), PREVCOM)

;-------------------------------------------------
;COMCOR(COM 보정치)
;-------------------------------------------------

;대응 관계 리스트를 돌려준다
@COMCORLIST()
#FUNCTIONS
RETURNF "적극/반항/활기/끈기/호의/붙임성/타락"

;번호로부터 명칭을 돌려준다
@GET_COMCORNAME(ARG)
#FUNCTIONS
RETURNF GET_NAME_LIST(ARG, COMCORLIST())

;명칭으로부터 번호를 돌려준다
@GET_COMCORNUM(ARGS)
#FUNCTION
RETURNF GET_NUM_LIST(ARGS, COMCORLIST())

;-------------------------------------------------
;공통 처리
;-------------------------------------------------
@ASSI_ARG_SET(ARG, ARGS)
#FUNCTION
ARG = (ARG == -99 ? ASSI # ARG)
RETURNF ARG

;-------------------------------------------------
;함수명:GET_NAME_LIST
;개  요점:LIST를 이용해 번호로부터 명칭을 취득하는 함수
;인  수:ARG… 번호, ARGS…LIST
;반환값:명칭
;-------------------------------------------------
@GET_NAME_LIST(ARG, ARGS)
#FUNCTIONS
#LOCALSSIZE 1000
;리스트를 분해
SPLIT ARGS, "/", LOCALS, LOCAL
;번호가 범위내인 것을 확인
IF ARG < 0 || ARG >= LOCAL
	;CALLF PRINT_ERRORMESSAGE(@"@GET_NAME_LIST 에 범위외의 번호({ARG})가 건네받았습니다")
	RETURNF 
ENDIF
;명칭을 돌려준다
RETURNF LOCALS:ARG

;-------------------------------------------------
;함수명:GET_NUM_LIST
;개  요점:LIST를 이용해 명칭으로부터 번호를 취득하는 함수
;인  수:ARGS… 명칭, ARGS:1…LIST
;반환값:번호
;-------------------------------------------------
@GET_NUM_LIST(ARGS, ARGS:1)
#FUNCTION
#LOCALSSIZE 1000
;리스트를 분해
SPLIT ARGS:1, "/", LOCALS, LOCAL
;명칭이 존재하는 것을 확인
LOCAL = FINDELEMENT(LOCALS, ARGS, 0, LOCAL, 1)
SIF LOCAL == -1
	CALLF PRINT_ERRORMESSAGE(@"@GET_NUM_LIST 에 부정한 명칭(%ARGS%)가 건네받았습니다")
;번호를 돌려준다
RETURNF LOCAL

;-------------------------------------------------
;함수명:IS_LIST
;개  요점:조사 리스트에 명칭과 합치하는 것이 있으면 진을 돌려준다
;       동시에 명칭 리스트에 합치하지 않으면 에러를 토한다
;인  수:ARGS… 조사 리스트(/단락으로 복수 대입이 가능합니다)
;       ARGS:1… 명칭 리스트, ARGS:2… 명칭
;반환값:진위치(1/0)
;-------------------------------------------------
@IS_LIST(ARGS, ARGS:1, ARG)
#FUNCTION
#LOCALSSIZE 1000
#DIMS LTEMPS, 10
;조사 리스트를 분해
SPLIT ARGS, "/", LTEMPS, LOCAL:1
;명칭 리스트를 분해
SPLIT ARGS:1, "/", LOCALS, LOCAL:2
;조사 리스트를 순서에 봐 간다
FOR LOCAL, 0, LOCAL:1
	;명칭 리스트로부터 번호를 취득
	SELECTCASE FINDELEMENT(LOCALS, LTEMPS:LOCAL, 0, LOCAL:2, 1)
		;명칭이 존재하는 것을 확인
		CASE -1
			CALLF PRINT_ERRORMESSAGE(@"@IS_LIST 에 부정한 명칭(%LTEMPS:LOCAL%)가 건네받았습니다")
			RETURNF -1
		;적합하면 진을 돌려준다
		CASE ARG
			RETURNF 1
	ENDSELECT
NEXT
RETURNF 0

;-------------------------------------------------
;함수명:MENUMATCH
;개  요점:ARG로 지정한 ACT 번호가 ARGS로 지정한 ACT분류에 포함되어 있을까를 돌려준다
;인  수:ARG…ACT 번호, ARGS…ACT분류
;반환값:포함되면 1, 포함되지 않으면 0
;-------------------------------------------------
@MENUMATCH(ARG, ARGS)
#FUNCTION
#LOCALSIZE 1
#DIM LCOUNT, 1
LOCAL = MENUNUM(ARGS)
FOR LCOUNT, 0, ACTM_NUM(LOCAL)
	SIF ACTM_NUM(LOCAL, LCOUNT) == GET_NORMALACTNUM(ARG)
		RETURNF 1
NEXT
RETURNF 0

;-------------------------------------------------
;함수명:ACTM_NUM
;개  요점:계열 번호로부터 계열 소속 ACT 번호를 돌려주는 함수
;인  수:ARG:0… 대상이 되는 계열 번호
;       ARG:1…-1이면 소속 ACT수, 0이후 소속 ACT 번호를 차례로 돌려준다
;반환값:소속 ACT수, ACT 번호
;-------------------------------------------------
@ACTM_NUM(ARG:0, ARG:1 = -1)
#FUNCTION
#LOCALSIZE 20
;LOCAL를-1에 초기화
VARSET LOCAL, -1
SELECTCASE ARG:0
	CASE 0
		LOCAL = 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 66
	CASE 1
		LOCAL = 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 27
	CASE 2
		LOCAL = 20, 21, 22, 23, 24, 25, 26, 68
	CASE 3
		LOCAL = 30, 31, 32, 33, 34, 35
	CASE 4
		LOCAL = 40, 41, 42, 43, 44, 45, 46, 73
	CASE 5
		LOCAL = 50, 51, 52, 53, 55, 56, 57
	CASE 6
		LOCAL = 60, 61, 62, 63, 64, 65, 66, 67, 68, 56
	CASE 7
		LOCAL = 70, 71, 72, 73, 74, 75, 9, 18, 55, 67
	CASE 9
		LOCAL = 90, 91, 92
	CASE 10
		LOCAL = 95, 96, 103, 97, 98, 99
ENDSELECT
;ARG:1이 부라면 소속 ACT수
SIF ARG:1 < 0
	RETURNF FINDELEMENT(LOCAL, -1)
;ARG:1이 정이라면 ACT 번호
SIF ARG:1 < VARSIZE("LOCAL")
	RETURNF LOCAL:(ARG:1)
;어느 쪽에도 맞지 않으면-1을 돌려준다
RETURNF -1

;-------------------------------------------------
;함수명:ACTMNAME_NUM
;개  요점:계열 명칭으로부터 계열 소속 ACT 번호를 돌려주는 함수
;인  수:ARGS:0… 대상이 되는 계열 명칭, 혹은 계열 번호를 나타내는 캐릭터 라인
;        ARG:0…-1이면 소속 ACT수, 0이후 소속 ACT 번호를 차례로 돌려준다
;반환값:소속 ACT수, ACT 번호
;-------------------------------------------------
@ACTMNAME_NUM(ARGS:0, ARG:0 = -1)
#FUNCTION
RETURNF ACTM_NUM(ISNUMERIC(ARGS:0) ? TOINT(ARGS:0) # MENUNUM(ARGS:0), ARG:0)

;-------------------------------------------------
;함수명:GET_ACTM
;개  요점:ACT 번호로부터 ACT분류번호를 취득하는 함수
;인  수:ARG…ACT 번호
;반환값:ACT분류번호
;비  고:미등록의 번호라면-1이 돌아간다
;-------------------------------------------------
@GET_ACTM, ARG
#FUNCTION
#DIM LCOUNT, 2
ARG = GET_NORMALACTNUM(ARG)
FOR LCOUNT, 0, 11
	FOR LCOUNT:1, 0, ACTM_NUM(LCOUNT, -1)
		SIF ARG == ACTM_NUM(LCOUNT, LCOUNT:1)
			RETURNF LCOUNT
	NEXT
NEXT
RETURNF -1

;-------------------------------------------------
;함수명:GET_COMBIACTNUM
;개  요점:ACT 번호로부터 콤비 네이션 ACT 번호 혹은 그 역을 취득하는 함수
;인  수:ARG…ACT 번호
;반환값:ACT 번호
;비  고:파생 조건을 채우지 않은 경우는-1을 돌려준다
;	    또, 이 함수 자체에 파생을 시키는 처리는 없는데도 주의
;-------------------------------------------------
@GET_COMBIACTNUM, ARG
#FUNCTION
SELECTCASE ARG
	;W자위/손으로애무
	CASE 10
		SIF PENIS(MASTER)
			RETURNF 300
	CASE 300
		RETURNF 10
	;W페라/입으로애무
	CASE 12
		SIF PENIS(MASTER)
			RETURNF 301
	CASE 301
		RETURNF 12
	;W키스/키스
	CASE 15
		RETURNF 302
	CASE 302
		RETURNF 15
	;W가랑이/성기를서로켠다
	CASE 16
		SIF PENIS(MASTER)
			RETURNF 303
	CASE 303
		RETURNF 16
	;W파이즈리/파이즈리한다
	CASE 17
		SIF PENIS(MASTER) && !GET_TALENT(ASSI:1, "남자")
			RETURNF 304
	CASE 304
		RETURNF 17
	;W풋잡/풋잡한다
	CASE 18
		SIF PENIS(MASTER)
			RETURNF 305
	CASE 305
		RETURNF 18
	;승마두구멍공격/승마위
	CASE 32
		SIF PENIS(ASSI:1) && !TALENT:MASTER:남자 && ABL:MASTER:A감각 > 1
			RETURNF 306
	CASE 306
		RETURNF 32
	;대면두구멍공격/대면좌위
	CASE 33
		SIF PENIS(ASSI:1) && !TALENT:MASTER:남자 && ABL:MASTER:A감각 > 1
			RETURNF 307
	CASE 307
		RETURNF 33
	;변칙혼란모란/배면좌위
	CASE 34
		RETURNF 308
	CASE 308
		RETURNF 34
	;애널두구멍공격/애널섹스
	CASE 35
		SIF PENIS(ASSI:1) && !TALENT:MASTER:남자 && !TALENT:MASTER:처녀
			RETURNF 309
	CASE 309
		RETURNF 35
	;W역강간/역강간
	CASE 103
		SIF PENIS(MASTER) && !GET_TALENT(ASSI:1, "남자")
			RETURNF 310
	CASE 310
		RETURNF 103
	;골짜기를건너감/정상위
	CASE 95
		SIF PENIS(MASTER) && !GET_TALENT(ASSI:1, "남자")
			RETURNF 311
	CASE 311
		RETURNF 95
	;2개빨고강제/입으로애무를강제
	CASE 51
		SIF PENIS(TARGET) && PENIS(ASSI:1)
			RETURNF 312
	CASE 312
		RETURNF 51
ENDSELECT
RETURNF -1

;-------------------------------------------------
;함수명:GET_COMBIACTNAME
;개  요점:ACT 명칭으로부터 콤비 네이션 ACT 명칭 혹은 그 역을 취득하는 함수
;인  수:ARGS…ACT 명칭
;반환값:ACT 명칭
;비  고:파생 조건을 채우지 않은 경우는"NONE"를 돌려준다
;	    또, 이 함수 자체에 파생을 시키는 처리는 없는데도 주의
;-------------------------------------------------
@GET_COMBIACTNAME, ARGS
#FUNCTIONS
RETURNF GET_ACTNAME(GET_COMBIACTNUM(GET_ACTNUM(ARGS)))

;-------------------------------------------------
;함수명:GET_SPACTNUM
;개  요점:ACT 번호로부터 SP액션 번호 혹은 그 역을 취득하는 함수
;인  수:ARG…ACT 번호
;반환값:ACT 번호
;비  고:파생 조건을 채우지 않은 경우는-1을 돌려준다
;	    또, 이 함수 자체에 파생을 시키는 처리는 없는데도 주의
;-------------------------------------------------
@GET_SPACTNUM, ARG
#FUNCTION
SELECTCASE ARG
	;바늘/파스웨이젼니돌
	CASE 62
		SIF NO:TARGET == 1 && CFLAG:조교레벨 > 0
			RETURNF 200
	CASE 200
		RETURNF 62
	;줄로 긴박/팔방귀박진
	CASE 63
		SIF NO:TARGET == 1 && ABL:기교 > 2
			RETURNF 201
	CASE 201
		RETURNF 63
	;기분 나쁘게 미소짓는다/광기의눈동자
	CASE 9
		SIF NO:TARGET == 28 && ABL:이상 > 1
			RETURNF 202
	CASE 202
		RETURNF 9
ENDSELECT
RETURNF -1

;-------------------------------------------------
;함수명:GET_SPACTNAME
;개  요점:ACT 명칭으로부터 콤비 네이션 ACT 명칭 혹은 그 역을 취득하는 함수
;인  수:ARGS…ACT 명칭
;반환값:ACT 명칭
;비  고:파생 조건을 채우지 않은 경우는"NONE"를 돌려준다
;	    또, 이 함수 자체에 파생을 시키는 처리는 없는데도 주의
;-------------------------------------------------
@GET_SPACTNAME, ARGS
#FUNCTIONS
RETURNF GET_ACTNAME(GET_SPACTNUM(GET_ACTNUM(ARGS)))

;-------------------------------------------------
;함수명:GET_NORMALACTNUM
;개  요점:콤비 네이션, SP액션 번호로부터 파생 전ACT 번호를 취득하는 함수
;인  수:ARG…ACT 번호
;반환값:ACT 번호
;비  고:변화한 ACT 번호를 원래대로 되돌리는 것. 원래 파생하고 있지 않는 경우는 그대로 돌려주므로 판정에 사용한다
;　　　파생원이 불명한 ACT 번호는 그대로 돌려준다
;-------------------------------------------------
@GET_NORMALACTNUM, ARG
#FUNCTION
;300접수대, 조수와의 콤비 네이션
IF ARG/100 == 3 && GET_COMBIACTNUM(ARG) >= 0
	RETURNF GET_COMBIACTNUM(ARG)
;200접수대, SP액션
ELSEIF ARG/100 == 2 && GET_SPACTNUM(ARG) >= 0
	RETURNF GET_SPACTNUM(ARG)
ENDIF
RETURNF ARG

;-------------------------------------------------
;함수명:GET_COMCOR
;개  요점:보정 종별의 COM 보정치를 취득(＆보존)
;인  수:ARGS…COM 보정 종명
;　　　 ARG … 기입했을 경우, 그 보정종의 수치를 기록
;반환값:지정한 COM 보정종의 보정치
;-------------------------------------------------
@GET_COMCOR(ARGS, ARG = -65535)
#FUNCTION
IF GET_COMCORNUM(ARGS) < 0
	CALLF PRINT_ERRORMESSAGE(@"@GET_COMCOR 에 무효인 COM 보정치명(%ARGS%)가 건네받았습니다")
	RETURNF -1
ENDIF
SIF ARG != -65535
	LOCAL:GET_COMCORNUM(ARGS) = ARG
RETURNF LOCAL:GET_COMCORNUM(ARGS)

;-------------------------------------------------
;함수명:GET_COMCORTYPE
;개  요점:COM호의계산 타입을 취득
;인  수:ARG …ACT 번호. 생략 하면 현재의 ACT
;반환값:지정한 ACT의 호의 계산 타입(캐릭터 라인)
;-------------------------------------------------
@GET_COMCORTYPE(ARG = -1)
#FUNCTIONS
ARG = ARG != -1 ? ARG # TFLAG:ACT
IF GET_ACTNAME(GET_NORMALACTNUM(ARG)) == "승마위"
	RETURNF "행위"
ELSEIF GET_ACTNAME(GET_NORMALACTNUM(ARG)) == "역강간"
	RETURNF "인내"
ELSEIF MENUMATCH(ARG, "성교") 
	RETURNF "인내"
ELSEIF MENUMATCH(ARG, "성적봉사") 
	RETURNF "행위"
ELSEIF GET_ACTNAME(ARG) == "자위"
	RETURNF "인내"
ELSEIF GET_ACTNAME(ARG) == "가슴애무" && TFLAG:ACT파생 == 2
	RETURNF "행위"
ELSEIF MENUMATCH(ARG, "애무")
	RETURNF "인내"
ELSEIF MENUMATCH(ARG, "도구")
	RETURNF "인내"
ELSEIF MENUMATCH(ARG, "봉사")
	RETURNF "행위"
ENDIF
RETURNF "굴복"

;-------------------------------------------------
;함수명:COMCOR_POSI
;개  요점:주로 소극적 따르는 계 COM의 기력 소비가 큰 때에, COM 보정치가 호의적인가 어떤가를 판단
;　　　 「마지못해서 하고 있다」의 것인지 「하고 싶은 것을 참고 있다」의 것인지 참조하기 위해서 이용한다
;인  수:ARGS… 행위(애무 강제→소극적한다등), 인내(애무→쾌감을참는다등), 굴복(합의를요구한다→심약구 답하는 등)
;　　　 생략 하면 현재의 ACT분류로부터 자동 생성한다
;반환값:행위라면 적극+붙임성＞반항*2  인내라면 호의+타락＞반항+활기  굴복이라면 호의+붙임성＞반항+끈기이면 1. 다르다면 0
;-------------------------------------------------
@COMCOR_POSI(ARGS)
#FUNCTION
ARGS = \@ ARGS == "" ? %GET_COMCORTYPE()% # %ARGS% \@
SELECTCASE ARGS
	CASE "행위"
		RETURNF GET_COMCOR("적극") + GET_COMCOR("붙임성") > GET_COMCOR("반항") * 2
	CASE "인내"
		RETURNF GET_COMCOR("호의") + GET_COMCOR("타락") > GET_COMCOR("반항") + GET_COMCOR("활기")
	CASE "굴복"
		RETURNF GET_COMCOR("호의") + GET_COMCOR("붙임성") > GET_COMCOR("반항") + GET_COMCOR("끈기")
ENDSELECT
RETURNF 0

;-------------------------------------------------
;함수명:GET_COMEFFORT
;인  수:ARGS …COM 명칭
;반환값:지정한 COM의 REACT부하
;-------------------------------------------------
@GET_COMEFFORT(ARGS)
#FUNCTION
RETURNF !COM_VITALITY("순위저", ARGS) ? 0 # (COM_VITALITY(, ARGS) >= 100)+1

;-------------------------------------------------
;함수명:GET_ASSIACTMATCH
;개  요점:조수ACT 명칭으로부터 그조수ACT를 실행하고 있는 조수 번호를 취득하는 함수
;인  수:ARGS… 조수ACT 명칭
;반환값:조수 번호(0～3)  그 행동을 한 조수가 없었던 경우는 0
;비  고:ASSI:1의 1이 조수 번호. 본래 ASSI:0은 행동중의 조수를 가리키지만,
;	　　여기서의 반환값 0은 지정한 행동을 취한 조수가 없는 것을 나타낸다
;	　　같은 행동을 취한 조수가 복수 있는 경우는, 번호의 젊은 (분)편을 우선한다
;-------------------------------------------------
@GET_ASSIACTMATCH, ARGS
#FUNCTION
#DIM LCOUNT, 1
;일단 조수의 수는 3명까지로 한다
FOR LCOUNT, 1, 4
	SIF ASSI:LCOUNT >= 0 && TCVAR:(ASSI:LCOUNT):조수ACT == GET_ASSIACTNUM(ARGS)
		RETURNF LCOUNT
NEXT
;히트 하지 않았으면 0으로 돌아온다
RETURNF 0

;-------------------------------------------------
;성교 주도권 취득 함수@SEX_INITIATIVE
;식중에서 사용하는 함수입니다. 현재의 성교로 주로 허리를 흔들고 있는 캐릭터의 등록 번호(성교가 발생하고 있지 않으면-1)을 돌려줍니다.
;인수에 캐릭터 등록 번호를 주었을 경우, 그 캐릭터에게 주도권이 있으면 실로 됩니다.
;-------------------------------------------------
@SEX_INITIATIVE(ARG = -2)
#FUNCTION
#DIM LCOUNT, 1
LOCAL = -1
IF 0
;ACT에 의한 판정
ELSEIF GET_ACTNAME(GET_NORMALACTNUM(TFLAG:ACT)) == "승마위"
	LOCAL = MASTER
ELSEIF GET_ACTNAME(GET_NORMALACTNUM(TFLAG:ACT)) == "역강간"
	LOCAL = TARGET
ELSEIF MENUMATCH(TFLAG:ACT, "성교") 
	LOCAL = TARGET
ELSEIF MENUMATCH(TFLAG:ACT, "성적봉사") 
	LOCAL = MASTER
;TEQUIP에 의한 판정
ELSEIF TEQUIP:성교중 == 3
	LOCAL = MASTER
ELSEIF TEQUIP:성교봉사중 == 3
	LOCAL = TARGET
ELSEIF TEQUIP:성교중
	LOCAL = TARGET
ELSEIF TEQUIP:성교봉사중
	LOCAL = MASTER
ENDIF
;현재 조수와의 섹스는, 조수측이 공격하고(통상 성교·역강간)로 밖에 발생하지 않는다. 체위의 개념도 없다
IF LOCAL == -1
	FOR LCOUNT, 1, 3
		IF ASSI:LCOUNT >= 0
			;조수ACT에 의한 판정
			IF GROUPMATCH(TCVAR:(ASSI:LCOUNT):조수ACT, GET_ASSIACTNUM("성교"), GET_ASSIACTNUM("역강간"))
				LOCAL = ASSI:LCOUNT
			;TEQUIP에 의한 판정
			ELSEIF TEQUIP:조수성교중 == ASSI:LCOUNT || TEQUIP:조수성교봉사중 == ASSI:LCOUNT
				LOCAL = ASSI:LCOUNT
			ENDIF
		ENDIF
	NEXT
ENDIF
RETURNF ARG == -2 ? LOCAL # ARG == LOCAL

;-------------------------------------------------
;체위 판정 함수@POSITION
;식중에서 사용하는 함수입니다. 인수를 TFLAG:90(ACT)으로 했을 경우의 체위를 TEQUIP:성교중 /TEQUIP:성교봉사중 준거로 돌려줍니다
;-------------------------------------------------
@POSITION(ARG)
#FUNCTION
SELECTCASE ARG
	;정상위/후배위/승마위/대면좌위/배면좌위/애널섹스
	CASE 30 TO 35
		RETURNF ARG - 29
	;역강간
	CASE 103
		RETURNF 3
	;정상위시킨다/후배위시킨다
	CASE 95, 96
		RETURNF ARG - 94
	;대면좌위시킨다/배면좌위시킨다/애널섹스시킨다
	CASE 97 TO 99
		RETURNF ARG - 93
ENDSELECT
RETURNF 0

;-------------------------------------------------
;V삽입 판정 함수@V_SEX
;식중에서 사용하는 함수입니다. 인수의 캐릭터가 V에 삽입중이라면 진(돌아가 값은 체위치)이 됩니다.
;현재 성교중·성교봉사중의 참조 뿐인 것으로, TARGET와 MASTER 이외는 연주합니다
;생략 하면 TARGET의 삽입, 즉 성교중을 참조합니다.
;-------------------------------------------------
@V_SEX(ARG = -2)
#FUNCTION
ARG = ARG == MASTER ? MASTER # TARGET
SIF ARG == TARGET
	RETURNF INRANGE(TEQUIP:성교중, 1, 5) ? TEQUIP:성교중 # 0
SIF ARG == MASTER
	RETURNF INRANGE(TEQUIP:성교봉사중, 1, 5) ? TEQUIP:성교봉사중 # 0
RETURNF 0

;-------------------------------------------------
;A삽입 판정 함수@A_SEX
;식중에서 사용하는 함수입니다. 인수의 캐릭터가 A에 삽입중이라면 진(돌아가 값은 체위치)이 됩니다.
;현재 성교중·성교봉사중의 참조 뿐인 것으로, TARGET와 MASTER 이외는 연주합니다
;생략 하면 TARGET의 삽입, 즉 성교중을 참조합니다.
;-------------------------------------------------
@A_SEX(ARG = -2)
#FUNCTION
ARG = ARG == MASTER ? MASTER # TARGET
SIF ARG == TARGET
	RETURNF TEQUIP:성교중 == 6 ? TEQUIP:성교중 # 0
SIF ARG == MASTER
	RETURNF TEQUIP:성교봉사중 == 6 ? TEQUIP:성교봉사중 # 0
RETURNF 0

;-------------------------------------------------
;전턴 V삽입 판정 함수@PREV_V_SEX
;식중에서 사용하는 함수입니다. 인수의 캐릭터가 전턴으로 V에 삽입중이라면 진(돌아가 값은 체위치)이 됩니다.
;전턴의 성교중·성교봉사중의 참조 뿐인 것으로, TARGET와 MASTER 이외는 연주합니다
;생략 하면 TARGET의 삽입, 즉 전턴성교를 참조합니다.
;-------------------------------------------------
@PREV_V_SEX(ARG = -2)
#FUNCTION
ARG = ARG == MASTER ? MASTER # TARGET
SIF ARG == TARGET
	RETURNF INRANGE(TFLAG:전턴성교, 1, 5) ? TFLAG:전턴성교 # 0
SIF ARG == MASTER
	RETURNF INRANGE(TFLAG:전턴성교봉사, 1, 5) ? TFLAG:전턴성교봉사 # 0
RETURNF 0

;-------------------------------------------------
;전턴 A삽입 판정 함수@PREV_A_SEX
;식중에서 사용하는 함수입니다. 인수의 캐릭터가 전턴으로 A에 삽입중이라면 진(돌아가 값은 체위치)이 됩니다.
;전턴의 성교중·성교봉사중의 참조 뿐인 것으로, TARGET와 MASTER 이외는 연주합니다
;생략 하면 TARGET의 삽입, 즉 전턴성교를 참조합니다.
;-------------------------------------------------
@PREV_A_SEX(ARG = -2)
#FUNCTION
ARG = ARG == MASTER ? MASTER # TARGET
SIF ARG == TARGET
	RETURNF TFLAG:전턴성교 == 6 ? TFLAG:전턴성교 # 0
SIF ARG == MASTER
	RETURNF TFLAG:전턴성교봉사 == 6 ? TFLAG:전턴성교봉사 # 0
RETURNF 0

;-------------------------------------------------
;함수명:PLEASURE_CHECK
;개  요점:쾌감 체크 함수
;인  수:ARG… 진이라면 MASTER의 기량
;            가짜라면 TARGET의 기량(생략시는 TARGET)
;반환값:진이라면 애무로 전혀 느끼지 않았던 것을 나타낸다
;비  고:식 안의 함수
;애무의 잘함과 못함을 판정하는 함수의 생각
;COM12를 참고로 하고 있지만, 독자적인 개조를 베풀었으므로
;뭔가 이상할지도 모른다. 참고 정도로…
;-------------------------------------------------
@PLEASURE_CHECK(ARG)
#FUNCTION
#LOCALSIZE 2
;MASTER가 TARGET에게 주는 쾌감을 체크
IF ARG
	;TARGET의 저항 정도
	LOCAL:0 = 20 + TALENT:프라이드높음 * 5 + TALENT:기장 * 5 - (CFLAG:호의 / 200)
	;TARGET가 받은 쾌감
	LOCAL:1 = SOURCE:쾌C * (1 + TALENT:C민감) + SOURCE:쾌V * (1 + TALENT:V민감) + SOURCE:쾌A * (1 + TALENT:A민감) + SOURCE:쾌B * (1 + TALENT:B민감)
	LOCAL:0 -= LOCAL:1 / (500 - TALENT:쾌감에순수 * 100 + TALENT:쾌감을부정 * 50)
;TARGET가 MASTER에게 주는 쾌감을 체크
ELSE
	;MASTER의 저항 정도
	LOCAL:0 = 20 + TALENT:MASTER:프라이드높음 * 5 + TALENT:MASTER:기장 * 5 + MARK:반항각인 + PALAM:MASTER:반항 / 500 - GET_ABL(MASTER, "순종") * 3 / 10 - CFLAG:MASTER:조교레벨
	;MASTER가 받은 쾌감
	LOCAL:1 = SOURCE:MASTER:쾌C * (1 + TALENT:MASTER:C민감) + SOURCE:MASTER:쾌V * (1 + TALENT:MASTER:V민감) + SOURCE:MASTER:쾌A * (1 + TALENT:MASTER:A민감) + SOURCE:MASTER:쾌B * (1 + TALENT:MASTER:B민감)
	LOCAL:0 -= LOCAL:1 / (500 - TALENT:MASTER:쾌감에순수 * 100 + TALENT:MASTER:쾌감을부정 * 50)
ENDIF
RETURNF LOCAL:0 > 0

;-------------------------------------------------
;함수명:CARESS_SPOT
;개  요점:애무 개소 함수
;인  수:ARG:0… 캐릭터 등록 번호. 생략 하면 TARGET
;반환값:그 캐릭터가 MASTER의 어디를 애무하고 있을까
;       (0. 하고 있지 않다/1. C/2.V/3.A/4.B/5. 입)
;비  고:식 안의 함수
;지정한 캐릭터가 어디를 애무하고 있는지를 표시. 자위 대응
;-------------------------------------------------
@CARESS_SPOT(ARG = -2)
#FUNCTION
ARG = ARG != -2 ? ARG # TARGET

SELECTCASE ARG
	;조교자의 경우
	CASE TARGET
		SIF MC_PLAYER() == 2 || GROUPMATCH(TFLAG:90, 62, 67)
			RETURNF 1
		SIF MV_PLAYER() == 2
			RETURNF 2
		SIF MA_PLAYER() == 2 || GROUPMATCH(TFLAG:90, 60, 61, 68)
			RETURNF 3
		SIF MB_PLAYER() == 2 || GROUPMATCH(TFLAG:90, 63)
			RETURNF 4
		SIF GROUPMATCH(TFLAG:90, 15, 51, 55, 56, 64, 65) || TEQUIP:안면승마 || TEQUIP:안면승마애널
			RETURNF 5
		RETURNF 0
	;조교 대상의 경우
	CASE MASTER
		SIF MC_PLAYER() == 1
			RETURNF 1
		SIF MV_PLAYER() == 1
			RETURNF 2
		SIF MA_PLAYER() == 1
			RETURNF 3
		SIF MB_PLAYER() == 1
			RETURNF 4
		RETURNF 0
	;조수 1의 경우
	CASE ASSI:1
		SELECTCASE TCVAR:(ASSI:1):조수ACT
			CASE 1, 3, 4, 5, 6, 7
				RETURNF 1
			CASE 30, 31, 32
				RETURNF 2
			CASE 10, 11, 12, 13, 14
				RETURNF 3
			CASE 20, 21, 22
				RETURNF 4
			CASE 40, 41, 42, 60
				RETURNF 5
			CASEELSE
				RETURNF 0
		ENDSELECT
	;조수 2의 경우
	CASE ASSI:2
		SELECTCASE TCVAR:(ASSI:2):조수ACT
			CASE 1, 3, 4, 5, 6, 7
				RETURNF 1
			CASE 30, 31, 32
				RETURNF 2
			CASE 10, 11, 12, 13, 14
				RETURNF 3
			CASE 20, 21, 22
				RETURNF 4
			CASE 40, 41, 42, 60
				RETURNF 5
			CASEELSE
				RETURNF 0
		ENDSELECT
ENDSELECT


;-------------------------------------------------
;함수명:MC_PLAYER
;개  요점:C애무자/애무물 판정 함수
;인  수:ARG… 진이라면 애무하고 있는 것이 무엇으로 있을까를 돌려준다
;            가짜라면 애무하고 있는 사람이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교자 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 족/8. 질구
;                 /90. 촉수
;                 /100. 로터/112. 클리캡/114. 오나홀
;       인의 경우→0. 없음/1. 조교 대상 자신/2. 조교자/4. 조수 1/8. 조수 2/16. 조수 3
;                 /64. 도구/128. 변소 이용자
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 애무자/애무물 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@MC_PLAYER(ARG)
#FUNCTION
#LOCALSIZE 1
;TEQUIP에 의한 판정 1(우선도고)
;애널섹스시킨다
SIF TEQUIP:성교봉사중 == 6
	RETURNF ARG ? 5 # 2
;성교봉사중(애널섹스 이외)
SIF TEQUIP:성교봉사중
	RETURNF ARG ? 4 # 2
;클리캡
SIF TEQUIP:클리캡 && ARG
	RETURNF 112
;오나홀
SIF TEQUIP:오나홀 && ARG
	RETURNF 114
;페니스밴드
SIF TEQUIP:페니스밴드 && ARG
	RETURNF 103

;조교자 액션에 의한 판정 1(우선도고)
SELECTCASE TFLAG:ACT
	;손으로애무/대면좌위/배면좌위/비패개장
	CASE 10, 33, 34, 41
		RETURNF ARG ? 2 # 2
	;입으로애무
	CASE 12
		RETURNF ARG ? 1 # 2
	;성기를서로켠다
	CASE 16
		RETURNF ARG ? 8 # 2
	;파이즈리한다
	CASE 17
		RETURNF ARG ? 6 # 2
	;풋잡한다
	CASE 18
		RETURNF ARG ? 7 # 2
	;로터
	CASE 20
		RETURNF ARG ? 100 # 2
	;가랑이
	CASE 53
		;명령에 따랐을 경우만
		SIF !IS_COMGRONAME("거부")
			RETURNF ARG ? 3 # 2
ENDSELECT

;계속 자위
SIF TEQUIP:조교대상C사용 == 1
	RETURNF ARG ? 2 # 2
;계속 페라
SIF TEQUIP:조교대상C사용 == 2
	RETURNF ARG ? 1 # 2
;조수 액션에 의한 판정
FOR LOCAL, 1, 4
	;조수가 없는 경우는 판정하지 않는다
	SIF ASSI:LOCAL < 0
		CONTINUE
	SELECTCASE TCVAR:(ASSI:LOCAL):조수ACT
		;입으로애무
		CASE 1
			RETURNF ARG ? 1 # (2 << LOCAL)
		;성기를서로켠다
		CASE 2
			RETURNF ARG ? 8 # (2 << LOCAL)
		;파이즈리한다
		CASE 3
			RETURNF ARG ? 6 # (2 << LOCAL)
		;풋잡한다
		CASE 4
			RETURNF ARG ? 7 # (2 << LOCAL)
		;도구로 애무
		CASE 5
			;애무자 판정
			SIF !ARG
				RETURNF (2 << LOCAL)
			;애무물 판정
			RETURNF PENIS(MASTER) ? 114 # 100
		;역강간
		CASE 6
			RETURNF ARG ? 3 # (2 << LOCAL)
		;손으로애무
		CASE 7
			RETURNF ARG ? 2 # (2 << LOCAL)
	ENDSELECT
NEXT

;조교자 액션에 의한 판정 2(우선도저)
SELECTCASE TFLAG:ACT
	;C애무도구
	CASE 24
		;애무자 판정
		SIF !ARG
			RETURNF 2
		;애무물 판정
		RETURNF PENIS(MASTER) ? 114 # 112
	;공중육변기플레이
	CASE 74
		;변기로서 사용되었을 경우
		SIF TFLAG:ACT파생 > 1
			RETURNF ARG ? 4 # 128
	;성교 봉사(애널섹스 이외)(저항되었다)
	CASE 103, 95 TO 98
		;쾌C를 얻고 있다
		SIF SOURCE:MASTER:쾌C > 0
			RETURNF ARG ? 4 # 2
	;애널섹스시킨다(저항되었다)
	CASE 99
		;쾌C를 얻고 있다
		SIF SOURCE:MASTER:쾌C > 0
			RETURNF ARG ? 5 # 2
ENDSELECT

;COM에 의한 판정
;도구를제외한다로 스스로 C관계 도구를 해제하고 있다
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "클리캡")
	RETURNF ARG ? 112 # 1
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "오나홀")
	RETURNF ARG ? 114 # 1
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "페니스밴드")
	RETURNF ARG ? 103 # 1

;TEQUIP에 의한 판정 2(우선도저)
;조교 대상 자위중(쾌C를 얻고 있다)
SIF GETBIT(TEQUIP:자위중, 0) && SOURCE:MASTER:쾌C > 0
	RETURNF ARG ? 2 # 1

;-------------------------------------------------
;함수명:ME_PLAYER
;개  요점:조교 대상 사정 대상 인물/물체 판정 함수
;인  수:ARG… 진이라면 사정 대상 물체가 무엇으로 있을까를 돌려준다
;            가짜라면 사정 대상 인물이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교자 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 족/8. 질구/9. 얼굴
;                /90. 촉수
;                /100. 로터/112. 클리캡/114. 오나홀
;       인의 경우→0. 없음/1. 조교 대상 자신/2. 조교자/4. 조수 1/8. 조수 2/16. 조수 3
;                /64. 도구/128. 변소 이용자
;비  고:식 안의 함수
;
;자위 얼굴에 사정하기 사정시 따위 애무물과 사정 대상 물체가 다른 경우를 상정해 신설
;MX_PLAYER 모두에 공통되는 것으로 해 대상이 복수 존재하는 경우 어찌할 도리가 없기 때문에
;그 중 캐릭터 라인으로 복수 대상을 모두 돌려주는 함수를 만들어도 괜찮을지도 모른다
;무엇이든 서두르고 하는 것도 아닌 것이 아닐까@이것 보고
;-------------------------------------------------
@ME_PLAYER(ARG)
#FUNCTION
#LOCALSIZE 1
#LOCALSSIZE 1
;비사정시는 0을 돌려준다
SIF !NOWEX:MASTER:사정
	RETURNF 0
;자위 사정, 적극적 따른다, 갈것같다, 초조하게해 종료/없음시
IF (IS_NOWACTNAME("자위") || GETBIT(TEQUIP:자위중, 0)) && IS_COMGRONAME("적극적 따른다") && TCVAR:MASTER:갈것같다 && TCVAR:MASTER:초조하게해번 < 2
	;1/2의 확률로 자위 얼굴에 사정하기 사정
	IF LOCALS != SAME_TURN()
		LOCALS = SAME_TURN()
		LOCAL = RAND:2
	ENDIF
	;자위 얼굴에 사정하기 사정시 이외는 특별한 처리를 실시하지 않는다
	;자위중에서도, 봉사·애무·성교·성교 봉사·가학·도구 ACT때는 얼굴에 사정하기에 무리가 있으므로 실시하지 않는다
	SIF LOCAL && !GROUPMATCH(GET_ACTM(TFLAG:ACT), 1, 2, 3, 5, 6, 10)
		RETURNF ARG ? 9 # 2
ENDIF
;그 외의 경우는 C애무자/애무물 판정 함수와 같은 물건을 돌려준다
RETURNF MC_PLAYER(ARG)


;-------------------------------------------------
;함수명:MV_PLAYER
;개  요점:V애무자/애무물 판정 함수
;인  수:ARG… 진이라면 애무하고 있는 것이 무엇으로 있을까를 돌려준다
;            가짜라면 애무하고 있는 사람이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교자 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 다리
;                 /10. 완/90. 촉수
;                 /100. 로터/101. 바이브/103. 페니스밴드/133. 삼각목마
;       인의 경우→0. 없음/1. 조교 대상 자신/2. 조교자/4. 조수 1/8. 조수 2/16. 조수 3
;                 /64. 도구/128. 변소 이용자
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 애무자/애무물 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@MV_PLAYER(ARG)
#FUNCTION
#LOCALSIZE 1
;남자는 제외함
SIF TALENT:MASTER:남자
	RETURNF 0

;TEQUIP에 의한 판정 1(우선도고)
;성교중(애널섹스 제외함)
IF TEQUIP:성교중 && TEQUIP:성교중 != 6
	;애무자 판정
	SIF !ARG
		RETURNF 2
	;애무물 판정
	RETURNF PENIS(TARGET) ? 3 # 103
ENDIF
;바이브
SIF TEQUIP:바이브 && ARG
	RETURNF 101
;페니스밴드
SIF TEQUIP:페니스밴드
	RETURNF MC_PLAYER(ARG)
;삼각목마
SIF TEQUIP:삼각목마 && ARG
	RETURNF 133

;조교자 액션에 의한 판정 1(우선도고)
;피스트퍽/양구멍피스트
SIF IS_NOWACTNAME("피스트퍽/양구멍피스트")
	RETURNF ARG ? 10 # 2

;조수 액션에 의한 판정
FOR LOCAL, 1, 4
	;조수가 없는 경우는 판정하지 않는다
	SIF ASSI:LOCAL < 0
		CONTINUE
	SELECTCASE TCVAR:(ASSI:LOCAL):조수ACT
		;손가락삽입
		CASE 30
			RETURNF ARG ? 2 # (2 << LOCAL)
		;바이브
		CASE 31
			RETURNF ARG ? 101 # (2 << LOCAL)
		;성교
		CASE 30
			;애무자 판정
			SIF !ARG
				RETURNF (2 << LOCAL)
			;애무물 판정
			RETURNF PENIS(ASSI:LOCAL) ? 3 # 103
	ENDSELECT
NEXT

;조교자 액션에 의한 판정 2(우선도저)
SELECTCASE TFLAG:ACT
	;바이브
	CASE 21
		RETURNF ARG ? 101 # 2
	;손가락삽입해라
	CASE 19
		RETURNF ARG ? 2 # 2
	;성교(애널섹스 이외)(저항되었다)
	CASE 30 TO 34
		;애무자 판정
		SIF !ARG
			RETURNF 2
		;애무물 판정
		RETURNF PENIS(TARGET) ? 3 # 103
	;삼각목마
	CASE 67
		RETURNF ARG ? 133 # 2
	;공중육변기플레이
	CASE 74
		;변기로서 사용되었을 경우
		SIF TFLAG:ACT파생 > 1
			RETURNF ARG ? 3 # 128
ENDSELECT

;COM에 의한 판정
;도구를제외한다로 스스로 V관계 도구를 해제하고 있다
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "바이브")
	RETURNF ARG ? 101 # 1
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "페니스밴드")
	RETURNF ARG ? 103 # 1

;TEQUIP에 의한 판정 2(우선도저)
;조교 대상 자위중(쾌V를 얻고 있다)
SIF GETBIT(TEQUIP:자위중, 0) && SOURCE:MASTER:쾌V > 0
	RETURNF ARG ? 2 # 1
;바이브
SIF TEQUIP:바이브
	RETURNF ARG ? 101 # 64


;-------------------------------------------------
;함수명:MA_PLAYER
;개  요점:A애무자/애무물 판정 함수
;인  수:ARG… 진이라면 애무하고 있는 것이 무엇으로 있을까를 돌려준다
;            가짜라면 애무하고 있는 사람이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교자 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 다리
;                 /10. 완/90. 촉수
;                 /100. 로터/102. 애널비즈/103. 페니스밴드/111. 애널바이브/132. 관장기＋플러그
;       인의 경우→0. 없음/1. 조교 대상 자신/2. 조교자/4. 조수 1/8. 조수 2/16. 조수 3
;                 /64. 도구/128. 변소 이용자
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 애무자/애무물 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@MA_PLAYER(ARG)
#FUNCTION
#LOCALSIZE 1
;TEQUIP에 의한 판정 1(우선도고)
;애널섹스중
IF TEQUIP:성교중 == 6
	;애무자 판정
	SIF !ARG
		RETURNF 2
	;애무물 판정
	RETURNF PENIS(TARGET) ? 3 # 103
ENDIF
;애널바이브
SIF TEQUIP:애널바이브 && ARG
	RETURNF 111
;애널비즈
SIF TEQUIP:애널비즈 && ARG
	RETURNF 102
;관장기＋플러그
SIF TEQUIP:관장기＋플러그 && ARG
	RETURNF 132

;조교자 액션에 의한 판정 1(우선도고)
SELECTCASE TFLAG:ACT
	;애널애무
	CASE 13
		RETURNF ARG ? 2 # 2
	;애널빨고
	CASE 14
		RETURNF ARG ? 1 # 2
	;애널비즈
	CASE 23
		;여기에서는 해제시의 처리만
		SIF TFLAG:ACT파생 == 1
			RETURNF ARG ? 102 # 2
	;관장기＋플러그
	CASE 68
		;여기에서는 해제시의 처리만
		SIF TFLAG:ACT파생 == 1
			RETURNF ARG ? 132 # 2
	;애널피스트/양구멍피스트
	CASE 71, 72
		RETURNF ARG ? 10 # 2
ENDSELECT

;조수 액션에 의한 판정
FOR LOCAL, 1, 4
	;조수가 없는 경우는 판정하지 않는다
	SIF ASSI:LOCAL < 0
		CONTINUE
	SELECTCASE TCVAR:(ASSI:LOCAL):조수ACT
		;애널애무
		CASE 10
			RETURNF ARG ? 2 # (2 << LOCAL)
		;애널빨고
		CASE 11
			RETURNF ARG ? 1 # (2 << LOCAL)
		;A로터
		CASE 12
			RETURNF ARG ? 100 # (2 << LOCAL)
		;애널바이브
		CASE 13
			RETURNF ARG ? 111 # (2 << LOCAL)
	ENDSELECT
NEXT

;조교자 액션에 의한 판정 2(우선도저)
SELECTCASE TFLAG:ACT
	;애널바이브
	CASE 22
		RETURNF ARG ? 111 # 2
	;애널비즈
	CASE 23
		RETURNF ARG ? 102 # 2
	;애널섹스(저항되었다)
	CASE 35
		;애무자 판정
		SIF !ARG
			RETURNF 2
		;애무물 판정
		RETURNF PENIS(TARGET) ? 3 # 103
	;관장기＋플러그
	CASE 68
		RETURNF ARG ? 132 # 2
	;공중육변기플레이
	CASE 74
		;변기로서 사용되었을 경우
		SIF TFLAG:ACT파생 > 1
			RETURNF ARG ? 3 # 128
ENDSELECT

;COM에 의한 판정
;도구를제외한다로 스스로 A관계 도구를 해제하고 있다
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "애널바이브")
	RETURNF ARG ? 111 # 1
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "애널비즈")
	RETURNF ARG ? 102 # 1
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "관장기＋플러그")
	RETURNF ARG ? 132 # 1

;TEQUIP에 의한 판정 2(우선도저)
;조교 대상 자위중(쾌A를 얻고 있다)
SIF GETBIT(TEQUIP:자위중, 0) && SOURCE:MASTER:쾌A > 0
	RETURNF ARG ? 111 # 1
;애널바이브
SIF TEQUIP:애널바이브
	RETURNF ARG ? 111 # 64
;애널비즈
SIF TEQUIP:애널비즈
	RETURNF ARG ? 102 # 64
;관장기＋플러그
SIF TEQUIP:관장기＋플러그
	RETURNF ARG ? 132 # 64


;-------------------------------------------------
;함수명:MB_PLAYER
;개  요점:B애무자/애무물 판정 함수
;인  수:ARG… 진이라면 애무하고 있는 것이 무엇으로 있을까를 돌려준다
;            가짜라면 애무하고 있는 사람이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교자 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 다리
;                 /90. 촉수
;                 /100. 로터/113. 니플캡
;       인의 경우→0. 없음/1. 조교 대상 자신/2. 조교자/4. 조수 1/8. 조수 2/16. 조수 3
;                 /64. 도구/128. 변소 이용자
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 애무자/애무물 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@MB_PLAYER(ARG)
#FUNCTION
#LOCALSIZE 1
;TEQUIP에 의한 판정 1(우선도고)
;니플캡
SIF TEQUIP:니플캡 && ARG
	RETURNF 113

;조교자 액션에 의한 판정 1(우선도고)
SELECTCASE TFLAG:ACT
	;손으로애무
	CASE 10
		;애무
		SIF !TFLAG:ACT파생
			RETURNF ARG ? 2 # 2
		RETURNF 
	;가슴애무
	CASE 11
		;애무자 판정
		SIF !ARG
			RETURNF 2
		;애무물 판정(유두흡 있고의 경우는 입)
		RETURNF TFLAG:ACT파생 == 1 ? 1 # 2
	;배면좌위
	CASE 34
		RETURNF ARG ? 2 # 2
	;파이즈리
	CASE 52
		;명령에 따랐을 경우만
		SIF !IS_COMGRONAME("거부")
			RETURNF ARG ? 3 # 2
ENDSELECT

;조수 액션에 의한 판정
FOR LOCAL, 1, 4
	;조수가 없는 경우는 판정하지 않는다
	SIF ASSI:LOCAL < 0
		CONTINUE
	SELECTCASE TCVAR:(ASSI:LOCAL):조수ACT
		;가슴애무
		CASE 20
			RETURNF ARG ? 2 # (2 << LOCAL)
		;유두빨고
		CASE 21
			RETURNF ARG ? 1 # (2 << LOCAL)
		;유두로터
		CASE 22
			RETURNF ARG ? 100 # (2 << LOCAL)
	ENDSELECT
NEXT

;조교자 액션에 의한 판정 2(우선도저)
SELECTCASE TFLAG:ACT
	;니플캡
	CASE 25
		RETURNF ARG ? 113 # 2
	;공중육변기플레이
	CASE 74
		;변기로서 사용되었다(남자는 제외함)
		SIF TFLAG:ACT파생 > 1 &&  !TALENT:MASTER:남자
			RETURNF ARG ? 3 # 128
ENDSELECT

;COM에 의한 판정
;도구를제외한다로 스스로 B관계 도구를 해제하고 있다
SIF SELECTCOM == GETNUM(TRAINNAME, "도구를제외한다") && TFLAG:REACT파생 == GETNUM(TEQUIP, "니플캡")
	RETURNF ARG ? 113 # 1

;TEQUIP에 의한 판정 2(우선도저)
;조교 대상 자위중(남자 이외, 쾌B를 얻고 있다)
SIF GETBIT(TEQUIP:자위중, 0) && !TALENT:MASTER:남자 && SOURCE:MASTER:쾌B > 0
	RETURNF ARG ? 2 # 1
;니플캡
SIF TEQUIP:니플캡
	RETURNF ARG ? 113 # 64

;-------------------------------------------------
;함수명:MASTER_EX
;개  요점:조교 대상 절정 판정 함수
;인  수:ARG:0… 애무자→1. 조교 대상 자신/2. 조교자/4. 조수 1/8. 조수 2/16. 조수 3
;                      /64. 도구/128. 변소 이용자  생략 하면 애무자를 묻지 않는다
;              비트화에서의 지정이 가능
;       ARG:1…(생략가능) 절정의 종별→1. C절정/2. V절정/3. A절정/4. B절정
;                                  /11. 분유/12. 사정/13. 방뇨
;반환값:이번 커맨드로, 지정한 애무자가 조교자를 지정의 절정에 이끌었는가 어떤가
;       ARG:1을 생략 했을 경우는 모든 절정에 도착해 비트로 돌려준다
;       (1. C절정/2. V절정/4. A절정/8. B절정/1024. 분유/2048. 사정/4096. 방뇨)
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 절정 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@MASTER_EX(ARG:0 = -1, ARG:1)
#FUNCTION
#LOCALSIZE 5
LOCAL:0 = 0
LOCAL:1 = MC_PLAYER(0)
LOCAL:2 = MV_PLAYER(0)
LOCAL:3 = MA_PLAYER(0)
LOCAL:4 = MB_PLAYER(0)

LOCAL:0 |= NOWEX:MASTER:C절정 && (ARG == -1 || (LOCAL:1 & ARG:0)) ? 1 # 0
LOCAL:0 |= NOWEX:MASTER:V절정 && (ARG == -1 || (LOCAL:2 & ARG:0)) ? 2 # 0
LOCAL:0 |= NOWEX:MASTER:A절정 && (ARG == -1 || (LOCAL:3 & ARG:0)) ? 4 # 0
LOCAL:0 |= NOWEX:MASTER:B절정 && (ARG == -1 || (LOCAL:4 & ARG:0)) ? 8 # 0

;분유 하려면 B절정→B애무자
LOCAL:0 |= NOWEX:MASTER:분유 && (ARG == -1 || (LOCAL:4 & ARG:0)) ? 1024 # 0

;사정하려면
;·사정/대량사정/드라이사정	:C절정→C애무자
;·조루					:쾌C  →C애무자
;·A책사정				:A절정→A애무자
;※A책사정이 아닌 사정은 C애무자, A책사정은 A애무자  후타나리는 V
LOCAL:0 |= (NOWEX:MASTER:사정 && NOWEX:MASTER:사정 != 5 && (ARG == -1 || (LOCAL:1 & ARG:0))) || (TALENT:MASTER:남자 && NOWEX:MASTER:사정 == 5 && (ARG == -1 || (LOCAL:3 & ARG:0))) || (TALENT:MASTER:후타나리 && NOWEX:MASTER:사정 == 5 && (ARG == -1 || (LOCAL:1 & ARG:0))) ? 2048 # 0

;방뇨하려면 C절정 or사정(하늘 이외) or쾌C가 필요
;(주의:미약이나 영양제에서도 게이지 증가하지만, 쾌CVAB중 한쪽이 없으면 실금 판정 자체 되지 않는다)
;·C절정		:C애무자
;·사정(하늘 이외)	:사정시킨 사람
;·쾌C			:C애무자
;※A책사정으로 A애무자가 우선이라면 A애무자, 그 이외는 C애무자. 우선 순위는 애무자의 숫자의 낮은 순서
;※C애무자를 봐야 할 때에 C애무자가 없는 경우:미약이나 영양제의 탓인 것으로, VAB를 우선 순위순서로 본다
IF NOWEX:MASTER:사정 == 5 && (!LOCAL:1 || LOCAL:1 > LOCAL:3)
	LOCAL:0 |= NOWEX:MASTER:방뇨 && (ARG == -1 || (LOCAL:3 & ARG:0)) ? 4096 # 0
ELSEIF LOCAL:1
	LOCAL:0 |= NOWEX:MASTER:방뇨 && (ARG == -1 || (LOCAL:1 & ARG:0)) ? 4096 # 0
ELSEIF LOCAL:2 && (!LOCAL:3 || LOCAL:2 < LOCAL:3) && (!LOCAL:4 || LOCAL:2 < LOCAL:4)
	LOCAL:0 |= NOWEX:MASTER:방뇨 && (ARG == -1 || (LOCAL:2 & ARG:0)) ? 4096 # 0
ELSEIF LOCAL:3 && (!LOCAL:4 || LOCAL:3 < LOCAL:4)
	LOCAL:0 |= NOWEX:MASTER:방뇨 && (ARG == -1 || (LOCAL:3 & ARG:0)) ? 4096 # 0
ELSE
	LOCAL:0 |= NOWEX:MASTER:방뇨 && (ARG == -1 || (LOCAL:4 & ARG:0)) ? 4096 # 0
ENDIF

RETURNF ARG:1 ? GETBIT(LOCAL:0, ARG:1 - 1) # LOCAL:0

;-------------------------------------------------
;함수명:TC_PLAYER
;개  요점:c애무자/애무물 판정 함수
;인  수:ARG… 진이라면 애무하고 있는 것이 무엇으로 있을까를 돌려준다
;            가짜라면 애무하고 있는 사람이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교 대상 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 족/8. 질구/103. 페니스밴드
;       인의 경우→0. 없음/1. 조교 대상/2. 조교자 자신/4. 조수 1/8. 조수 2/16. 조수 3/64. 도구
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 애무자/애무물 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@TC_PLAYER(ARG)
#FUNCTION
;TEQUIP에 의한 판정 1(우선도고)
;애널섹스(조교자에게 페니스가 있는 경우만)
SIF PENIS(TARGET) && TEQUIP:성교중 == 6
	RETURNF ARG ? 5 # 1
;성교중(애널섹스 이외)(조교자에게 페니스가 있는 경우만)
SIF PENIS(TARGET) && TEQUIP:성교중
	RETURNF ARG ? 4 # 1
;안면승마
SIF TEQUIP:안면승마 && !TEQUIP:안면승마애널
	RETURNF ARG ? 1 # 1
;조교자페니스밴드
SIF TEQUIP:조교자페니스밴드 && ARG
	RETURNF 103

;조교자 액션에 의한 판정 1(우선도고)
SELECTCASE TFLAG:ACT
	;성기를서로켠다
	CASE 16
		;애무자 판정
		SIF !ARG
			RETURNF 1
		;애무물 판정
		RETURNF PENIS(MASTER) ? 3 # 8
	;손으로애무를강제
	CASE 50
		;봉사했을 경우만
		SIF !IS_COMGRONAME("거부")
			RETURNF ARG ? 2 # 1
	;입으로애무를강제
	CASE 51
		;안면승마/안면승마애널 이외, 한편 봉사했을 경우만
		SIF TFLAG:ACT파생 != 2 && TFLAG:ACT파생 != 3 && !IS_COMGRONAME("거부")
			RETURNF ARG ? 1 # 1
	;파이즈리
	CASE 52
		;봉사했을 경우만
		SIF !IS_COMGRONAME("거부")
			RETURNF ARG ? 6 # 1
	;가랑이
	CASE 53
		;봉사했을 경우만
		SIF !IS_COMGRONAME("거부")
			RETURNF ARG ? 8 # 1
	;이라마치오
	CASE 56
		RETURNF ARG ? 1 # 1
	;대면좌위시킨다/배면좌위시킨다
	CASE 97, 98
		RETURNF ARG ? 2 # 1
ENDSELECT

;조교자 추가 액션에 의한 판정
;조수 액션에 의한 판정

;조교자 액션에 의한 판정 2(우선도저)
SELECTCASE TFLAG:ACT
	;성교(애널섹스 이외)(저항되었다)
	CASE 30 TO 34
		RETURNF ARG ? 4 # 1
	;애널섹스(저항되었다)
	CASE 35
		RETURNF ARG ? 5 # 1
	;입으로애무를강제
	CASE 51
		;안면승마(저항되었다)
		SIF TFLAG:ACT파생 == 2
			RETURNF ARG ? 1 # 1
ENDSELECT

;TEQUIP에 의한 판정 2(우선도저)
;조교 대상 자위중(쾌c를 얻고 있다)
SIF GETBIT(TEQUIP:자위중, 1) && SOURCE:쾌C > 0
	RETURNF ARG ? 2 # 2


;-------------------------------------------------
;함수명:TE_PLAYER
;개  요점:조교자 사정 대상 인물/물체 판정 함수
;인  수:ARG… 진이라면 사정 대상 물체가 무엇으로 있을까를 돌려준다
;            가짜라면 사정 대상 인물이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교 대상 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 족/9. 얼굴
;                /90. 촉수
;                /100. 로터/112. 클리캡/114. 오나홀
;       인의 경우→0. 없음/1. 조교 대상/2. 조교자 자신/4. 조수 1/8. 조수 2/16. 조수 3
;                /64. 도구/128. 변소 이용자
;비  고:식 안의 함수
;
;ME_PLAYER와 동시에 설치@이것 보고
;-------------------------------------------------
@TE_PLAYER(ARG)
#FUNCTION
#LOCALSIZE 1
#LOCALSSIZE 1
;비사정시는 0을 돌려준다
SIF !NOWEX:사정
	RETURNF 0
;자위 사정시
IF GETBIT(TEQUIP:자위중, 1)
	;1/2의 확률로 자위 얼굴에 사정하기 사정
	IF LOCALS != SAME_TURN()
		LOCALS = SAME_TURN()
		LOCAL = RAND:2
	ENDIF
	;자위 얼굴에 사정하기 사정시 이외는 특별한 처리를 실시하지 않는다
	;자위중에서도, 봉사·애무·성교·성교 봉사·도구 ACT때는 얼굴에 사정하기에 무리가 있으므로 실시하지 않는다
	SIF LOCAL && !GROUPMATCH(GET_ACTM(TFLAG:ACT), 1, 2, 3, 5, 10)
		RETURNF ARG ? 9 # 1
ENDIF
;그 외의 경우는 C애무자/애무물 판정 함수와 같은 물건을 돌려준다
RETURNF TC_PLAYER(ARG)


;-------------------------------------------------
;함수명:TV_PLAYER
;개  요점:v애무자/애무물 판정 함수
;인  수:ARG… 진이라면 애무하고 있는 것이 무엇으로 있을까를 돌려준다
;            가짜라면 애무하고 있는 사람이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교 대상 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 다리
;                 /101. 바이브/103. 페니스밴드
;       인의 경우→0. 없음/1. 조교 대상/2. 조교자 자신/4. 조수 1/8. 조수 2/16. 조수 3/64. 도구
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 애무자/애무물 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@TV_PLAYER(ARG)
#FUNCTION
;남자는 제외함
SIF TALENT:TARGET:남자
	RETURNF 0

;TEQUIP에 의한 판정 1(우선도고)
;성교봉사중(애널섹스시킨다 이외)
IF TEQUIP:성교봉사중 && TEQUIP:성교봉사중 != 6
	SIF TEQUIP:페니스밴드
		RETURNF ARG ? 103 # 1
	RETURNF ARG ? 3 # 1
ENDIF

;조교자페니스밴드
SIF TEQUIP:조교자페니스밴드
	RETURNF TC_PLAYER(ARG)
;조교자 액션에 의한 판정 1(우선도고)
;조교자 추가 액션에 의한 판정
;조수 액션에 의한 판정

;조교자 액션에 의한 판정 2(우선도저)
SELECTCASE TFLAG:ACT
	;성교 봉사(애널섹스시킨다 이외)(저항되었다)
	CASE 103, 95 TO 98
		SIF TEQUIP:페니스밴드
			RETURNF ARG ? 103 # 1
		RETURNF ARG ? 3 # 1
ENDSELECT

;TEQUIP에 의한 판정 2(우선도저)
;조교자 자위중(쾌v를 얻고 있다)
SIF GETBIT(TEQUIP:자위중, 1) && SOURCE:쾌V > 0
	RETURNF ARG ? 101 # 2

;-------------------------------------------------
;함수명:TA_PLAYER
;개  요점:a애무자/애무물 판정 함수
;인  수:ARG… 진이라면 애무하고 있는 것이 무엇으로 있을까를 돌려준다
;            가짜라면 애무하고 있는 사람이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교 대상 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 다리
;       인의 경우→0. 없음/1. 조교 대상/2. 조교자 자신/4. 조수 1/8. 조수 2/16. 조수 3
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 애무자/애무물 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@TA_PLAYER(ARG)
#FUNCTION
;TEQUIP에 의한 판정 1(우선도고)
;안면승마애널
SIF TEQUIP:안면승마애널
	RETURNF ARG ? 1 # 1
;애널섹스시킨다
SIF TEQUIP:성교봉사중 == 6
	RETURNF ARG ? 3 # 1

;조교자 액션에 의한 판정 1(우선도고)
;조교자 추가 액션에 의한 판정
;조수 액션에 의한 판정

;조교자 액션에 의한 판정 2(우선도저)
SELECTCASE TFLAG:ACT
	;입으로애무를강제
	CASE 51
		;안면승마애널(저항되었다)
		SIF TFLAG:ACT파생 == 3
			RETURNF ARG ? 1 # 1
	;애널섹스시킨다(저항되었다)
	CASE 99
		RETURNF ARG ? 3 # 1
ENDSELECT

;TEQUIP에 의한 판정 2(우선도저)

;-------------------------------------------------
;함수명:TB_PLAYER
;개  요점:b애무자/애무물 판정 함수
;인  수:ARG… 진이라면 애무하고 있는 것이 무엇으로 있을까를 돌려준다
;            가짜라면 애무하고 있는 사람이 누구인 것인지를 돌려준다. 복수 존재하는 경우는 조교 대상 우선
;반환값:물건의 경우→0. 없음/1. 구/2. 수/3. 페니스/4. 바기나/5. 애널/6. 흉/7. 다리
;       인의 경우→0. 없음/1. 조교 대상/2. 조교자 자신/4. 조수 1/8. 조수 2/16. 조수 3
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 애무자/애무물 판정 함수
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@TB_PLAYER(ARG)
#FUNCTION
;TEQUIP에 의한 판정 1(우선도고)

;조교자 액션에 의한 판정 1(우선도고)
SELECTCASE TFLAG:ACT
	;가슴애무
	CASE 11
		;몸싸움으로, 소극적 따른다/적극적 따르는 것 경우
		SIF TFLAG:ACT파생 == 2 && (IS_COMGRONAME("소극적 따른다/적극적 따른다"))
			RETURNF ARG ? 2 # 1
	;파이즈리한다
	CASE 17
		RETURNF ARG ? 3 # 1
	;가슴애무강제
	CASE 57
		;봉사했을 경우
		IF !IS_COMGRONAME("거부")
			;애무자 판정
			SIF !ARG
				RETURNF 1
			;애무물 판정(입애무는 입)
			RETURNF TFLAG:ACT파생 ? 1 # 2
		ENDIF
	;배면좌위시킨다
	CASE 98
		RETURNF ARG ? 2 # 1
ENDSELECT

;조교자 추가 액션에 의한 판정
;조수 액션에 의한 판정
;조교자 액션에 의한 판정 2(우선도저)

;TEQUIP에 의한 판정 2(우선도저)
;조교자 자위중(남자 이외, 쾌b를 얻고 있다)
SIF GETBIT(TEQUIP:자위중, 1) && !TALENT:TARGET:남자 && SOURCE:쾌V > 0
	RETURNF ARG ? 2 # 2

;-------------------------------------------------
;함수명:TARGET_EX
;개  요점:조교자 절정 판정 함수
;인  수:ARG:0… 애무자→1. 조교 대상/2. 조교자 자신/4. 조수 1/8. 조수 2/16. 조수 3
;              비트화에서의 지정이 가능. 생략 하면 애무자를 묻지 않는다
;       ARG:1…(생략가능) 절정의 종별→1. c절정/2. v절정/3. a절정/4. b절정
;                                  /11. 분유/12. 사정
;반환값:이번 커맨드로, 지정한 애무자가 조교자를 지정의 절정에 이끌었는가 어떤가
;       ARG:1을 생략 했을 경우는 모든 절정에 도착해 비트로 돌려준다
;       (1. c절정/2. v절정/4. a절정/8. b절정/1024. 분유/2048. 사정)
;비  고:식 안의 함수
;사양을 정리해 다시 만든, 새로운 절정 판정 함수
;실은 현상으로 유효하게 사용할 수 있는 장면이 그다지 없을지도 모른다
;리액션 구상이나 절정 구상에서의 사용을 상정하고 있다
;-------------------------------------------------
@TARGET_EX(ARG:0 = -1, ARG:1)
#FUNCTION
#LOCALSIZE 5
LOCAL:0 = 0
LOCAL:1 = TC_PLAYER(0)
LOCAL:2 = TV_PLAYER(0)
LOCAL:3 = TA_PLAYER(0)
LOCAL:4 = TB_PLAYER(0)

LOCAL:0 |= NOWEX:C절정 && (ARG == -1 || (LOCAL:1 & ARG)) ? 1 # 0
LOCAL:0 |= NOWEX:V절정 && (ARG == -1 || (LOCAL:2 & ARG)) ? 2 # 0
LOCAL:0 |= NOWEX:A절정 && (ARG == -1 || (LOCAL:3 & ARG)) ? 4 # 0
LOCAL:0 |= NOWEX:B절정 && (ARG == -1 || (LOCAL:4 & ARG)) ? 8 # 0

;분유 하려면 b절정→b애무자
LOCAL:0 |= NOWEX:분유 && (ARG == -1 || (LOCAL:4 & ARG)) ? 1024 # 0
;사정하려면 c절정→c애무자
LOCAL:0 |= NOWEX:사정 && (ARG == -1 || (LOCAL:1 & ARG)) ? 2048 # 0

RETURNF ARG:1 ? GETBIT(LOCAL:0, ARG:1 - 1) # LOCAL:0

;-------------------------------------------------
;행동명 표시 함수@ACTSTR
;식중에서 사용하는 함수입니다. 인수 번호의 조교자 액션명을 캐릭터 라인으로 돌려줍니다
;인수 1이 0이라면 트라우마의 종용으로, 「관장기＋플러그」등 무기인 것은 유기적인 호칭으로 고칩니다
;
;어딘지 모르게 추가했지만 멋진 표현을 할 수 없었다… 미안…
;이 손의 함수는 필요하면 캐릭터별로 가지는 일도 검토하는 것이 좋아!
;범용적으로는 한 생각이지만, 캐릭터나 성격에 의해 어조에 맞는 단어·맞지 않는 단어는 있네요
;-------------------------------------------------
@ACTSTR(ARG:0, ARG:1)
#FUNCTIONS
IF !ARG:1
	SELECTCASE ARG:0
		;지금의기분을얘기한다/자신에게로의기분을얘기한다/합의를요구한다
		CASE 0, 1, 6
			RETURNF "이상한 질문"
		;성에대한이야기를한다
		CASE 2
			RETURNF \@ TALENT:TARGET:호색 || TALENT:TARGET:심술쟁이 ? 추잡함 # 엣치한 \@ + "이야기"
		;상냥하게위로한다
		CASE 3
			RETURNF "위안"
		;엄격하게위협한다/고함친다/기분나쁘게웃는다
		CASE 4, 8, 9
			RETURNF "위협해져"
		;의상의변경을요구한다
		CASE 5
			RETURNF "벗겨져"
		;벌이라고선언한다
		CASE 7
			RETURNF "벌"
		;손으로애무/가슴애무/성기를서로켠다/파이즈리한다
		CASE 10, 11, 16, 17
			RETURNF "이상한 손대는 방법 되어"
		;풋잡한다
		CASE 18
			RETURNF "다리로 밟혀"
		;손가락삽입해라
		CASE 19
			RETURNF "손가락으로 휘저어져"
		;입으로애무
		CASE 12
			RETURNF \@ PENIS(MASTER) ? 페라 # 구에서 \@ + "되어"
		;애널애무/애널빨고
		CASE 13, 14
			RETURNF "엉덩이" + \@ IS_NOWACTNAME("애널애무") ? 농 # 빨고 \@ + "의"
		;키스
		CASE 15
			RETURNF "키스"
		;C애무도구
		CASE 24
			RETURNF \@ PENIS(MASTER) ? 오나홀 # 클리캡 \@
		;밀어넘어뜨린다
		CASE 27
			RETURNF "밀어 넘어뜨려져"
		;정상위/대면좌위/역강간
		CASE 30, 33, 103
			RETURNF "범해져"
		;후배위/배면좌위
		CASE 31, 34
			RETURNF "뒤로부터 범해져"
		;애널섹스
		CASE 35
			RETURNF "뒤를 범해져"
		;자위
		CASE 40
			RETURNF "자위 당해"
		;비패개장
		CASE 41
			RETURNF "넓힐 수 있어"
		;자위과시하고
		CASE 42
			RETURNF "자위 보여져"
		;수치플레이
		CASE 43
			RETURNF "거울에 비추어져"
		;야외플레이
		CASE 44
			RETURNF "외에 데리고 나가져"
		;방뇨
		CASE 45
			RETURNF "흘려"
		;손으로애무를강제
		CASE 50
			RETURNF "손대어"
		;입으로애무를강제
		CASE 51
			RETURNF "빨게 되어져"
		;다리빨고강제
		CASE 55
			RETURNF "다리를 빨게 되어져"
		;가슴애무강제
		CASE 57
			RETURNF "젖가슴"
		;스팽킹
		CASE 60
			RETURNF "얻어맞아"
		;줄
		CASE 63
			RETURNF "속박되어"
		;아이마스크
		CASE 64
			RETURNF "눈가리개 되어"
		;매도
		CASE 66
			RETURNF "말고문 되어"
		;관장세트
		CASE 68
			RETURNF "관장되어"
		;피스트퍽/애널피스트/양구멍피스트
		CASE 70 TO 72
			RETURNF "팔을 넣어"
		;공중육변기플레이
		CASE 74
			RETURNF "화장실이 되어"
		;촉수소환		미실장
		;CASE 80
		;	RETURNF "촉수"
		;쉬게한다
		CASE 90
			RETURNF "휴게"
		;영양제를먹인다
		CASE 91
			RETURNF "약을 먹게 되어"
		;치료한다
		CASE 92
			RETURNF "이상한 치료하는 방법 되어"
		;정상위시킨다/후배위시킨다/대면좌위시킨다/배면좌위시킨다
		CASE 95 TO 98
			RETURNF "섹스 당해"
		;애널섹스시킨다
		CASE 99
			RETURNF "뒤로 넣게 되어져"
		;그 외
		CASEELSE
			RETURNF STR:(CFLAG:MASTER:트라우마)
	ENDSELECT
ENDIF
RETURNF STR:(ARG + 100)

;-------------------------------------------------
;함수명:EXP_INSUFF
;개  요점:경험 부족 체크 함수
;인  수:ARG… 행위자(TARGET나 ASSI의 누군가)
;반환값:경험 부족 레벨. 0이라면 경험 충분히
;비  고:식 안의 함수
;경험 부족의 경우, 반환값이 진(부족 레벨에 응해 1～4까지)(이)가 된다
;많이 귀찮은 만들어 하고 있지만 좋아 이대로…
;-------------------------------------------------
@EXP_INSUFF(ARG = -1)
#FUNCTION
#LOCALSIZE 2
;인수 부정하면 돌아온다
SIF ARG < 0
	RETURNF 0

;경험 판정 패턴(비트화)
;(1p0:V경험, 1p1:A경험, 1p2:분유경험, 1p3:V성교, 1p4:A성교, 1p5:역강간, 1p6:V피스트, 1p7:A피스트)
LOCAL:0 = 0

;경험 부족 레벨(비트화)
;(0~3bit:V경험 부족 Lv, 4~7bit:A경험 부족 Lv, 8~11bit:역강간 경험 부족 Lv)
;지수 메모(p0:V경험 부족 Lv, p4:A경험 부족 Lv, p8:역강간 경험 부족 Lv)
LOCAL:1 = 0

;조교자에 의한 플레이를 판정
IF ARG == TARGET
	;ACT의 판정
	SELECTCASE TFLAG:ACT
		;A경험 체크
		;애널애무, 애널빨고, 애널비즈
		CASE 13, 14, 23
			LOCAL:0 |= 1p1
		;V성교경험 체크
		;정상위, 후배위, 승마위, 대면좌위, 배면좌위, 승마 두 구멍 꾸짖어, 대면 두 구멍 꾸짖어, 변칙혼란모란, 골짜기를건너감
		CASE 30 TO 34, 306 TO 308, 311
			LOCAL:0 |= 1p3
		;A성교경험 체크
		;애널섹스, 애널 두 구멍 고문
		CASE 35, 309
			LOCAL:0 |= 1p4
		;성교경험 체크
		;정상위시킨다～역강간, 애널섹스시킨다, W역강간
		CASE 95 TO 103, 310
			LOCAL:0 |= 1p5
		;V확장경험체크
		;피스트퍽
		CASE 70
			LOCAL:0 |= 1p6
		;A확장경험체크
		;애널피스트
		CASE 71
			LOCAL:0 |= 1p7
		;V확장경험체크＋A확장경험체크
		;양구멍피스트
		CASE 72
			LOCAL:0 |= 1p6 | 1p7
		;도구 장착시만 V경험 체크
		;바이브
		CASE 21
			;파생(장착)
			SIF TFLAG:ACT파생 == 0
				LOCAL:0 |= 1p0
		;도구 장착시만 A경험 체크
		;애널바이브, 관장기＋플러그
		CASE 22, 68
			;파생(장착)
			SIF TFLAG:ACT파생 == 0
				LOCAL:0 |= 1p1
	ENDSELECT
	;추가행동의 판정
	SELECTCASE TFLAG:추가행동
		;V경험 체크
		CASE 2
			LOCAL:0 |= 1p0
		;A경험 체크
		CASE 3
			LOCAL:0 |= 1p1
	ENDSELECT
;조수에 의한 플레이를 판정
ELSE
	;조수ACT의 판정
	SELECTCASE NOWASSIACTNAME(ARG)
		CASE "역강간"
			;성교 봉사 경험 체크
			LOCAL:0 |= 1p5
		CASE "애널애무", "애널빨고", "애널로터", "애널바이브"
			;A경험 체크
			LOCAL:0 |= 1p1
		CASE "성교"
			;V성교경험 체크
			LOCAL:0 |= 1p3
		CASE "손가락삽입", "바이브"
			;V경험 체크
			LOCAL:0 |= 1p0
	ENDSELECT
	;콤비 네이션의 판정
	SELECTCASE TFLAG:ACT
		;A성교경험 체크
		;승마 두 구멍 꾸짖어, 대면 두 구멍 고문
		CASE 306, 307
			LOCAL:0 |= 1p4
		;V성교경험 체크
		;애널 두 구멍 고문
		CASE 309
			LOCAL:0 |= 1p3
		;성교경험 체크
		;W역강간
		CASE 310
			LOCAL:0 |= 1p5
	ENDSELECT
ENDIF

;1p0:V경험 체크
;노예의 V경험을 판정→V경험 부족으로서 취급한다(p0)
IF LOCAL:0 & 1p0
	IF EXP:MASTER:V경험 < 1
		LOCAL:1 |= 3p0
	ELSEIF EXP:MASTER:V경험 < 4
		LOCAL:1 |= 2p0
	ELSEIF EXP:MASTER:V경험 < 6
		LOCAL:1 |= 1p0
	ENDIF
ENDIF

;1p1:A경험 체크
;노예의 A경험을 판정→A경험 부족으로서 취급한다(p4)
IF LOCAL:0 & 1p1
	IF EXP:MASTER:A경험 < 1
		LOCAL:1 |= 4p4
	ELSEIF EXP:MASTER:A경험 < 6
		LOCAL:1 |= 3p4
	ELSEIF EXP:MASTER:A경험 < 11
		LOCAL:1 |= 2p4
	ELSEIF EXP:MASTER:A경험 < 21
		LOCAL:1 |= 1p4
	ENDIF
ENDIF

;1p3:V성교경험 체크
;노예의 V경험과 성교경험을 판정→V경험 부족으로서 취급한다(p0)
IF LOCAL:0 & 1p3
	IF EXP:MASTER:V경험 < 1
		LOCAL:1 |= 3p0
	ELSEIF EXP:MASTER:V경험 < 6 && EXP:MASTER:성교경험 < 5
		LOCAL:1 |= 2p0
	ELSEIF EXP:MASTER:V경험 < 11 && EXP:MASTER:성교경험 < 9
		LOCAL:1 |= 1p0
	ENDIF
ENDIF

;1p4:A성교경험 체크
;노예의 A경험과 성교경험을 판정→A경험 부족으로서 취급한다(p4)
IF LOCAL:0 & 1p4
	IF EXP:MASTER:A경험 < 1
		LOCAL:1 |= 4p4
	ELSEIF EXP:MASTER:A경험 < 6 && EXP:MASTER:성교경험 < 11
		LOCAL:1 |= 3p4
	ELSEIF EXP:MASTER:A경험 < 13 && EXP:MASTER:성교경험 < 21
		LOCAL:1 |= 2p4
	ELSEIF EXP:MASTER:A경험 < 26 && EXP:MASTER:성교경험 < 31
		LOCAL:1 |= 1p4
	ENDIF
ENDIF

;1p5:역강간 경험 체크
;노예의 성교경험과 조교레벨을 판정→역강간 경험 부족으로서 취급한다(p8)
IF LOCAL:0 & 1p5
	IF EXP:MASTER:성교경험 < 1 && CFLAG:MASTER:조교레벨 < 3
		LOCAL:1 |= 4p8
	ELSEIF EXP:MASTER:성교경험 < 6 && CFLAG:MASTER:조교레벨 < 5
		LOCAL:1 |= 3p8
	ELSEIF EXP:MASTER:성교경험 < 13 && CFLAG:MASTER:조교레벨 < 8
		LOCAL:1 |= 2p8
	ELSEIF EXP:MASTER:성교경험 < 26 && CFLAG:MASTER:조교레벨 < 11
		LOCAL:1 |= 1p8
	ENDIF
ENDIF

;1p6:V확장경험체크(피스트퍽)
;노예의 V경험과 V확장경험를 판정→V경험 부족으로서 취급한다(p0)
IF LOCAL:0 & 1p6
	IF EXP:MASTER:V경험 < 20 || EXP:MASTER:V확장경험 < 1
		LOCAL:1 |= 4p0
	ELSEIF EXP:MASTER:V경험 < 25 || EXP:MASTER:V확장경험 < 2
		LOCAL:1 |= 3p0
	ELSEIF EXP:MASTER:V경험 < 30 || EXP:MASTER:V확장경험 < 4
		LOCAL:1 |= 2p0
	ELSEIF EXP:MASTER:V확장경험 < 6
		LOCAL:1 |= 1p0
	ENDIF
ENDIF

;1p7:A확장경험체크(애널피스트)
;노예의 A경험과 A확장경험를 판정→A경험 부족으로서 취급한다(p4)
IF LOCAL:0 & 1p7
	IF EXP:MASTER:A경험 < 20 || EXP:MASTER:A확장경험 < 1
		LOCAL:1 |= 4p4
	ELSEIF EXP:MASTER:A경험 < 25 || EXP:MASTER:A확장경험 < 2
		LOCAL:1 |= 3p4
	ELSEIF EXP:MASTER:A경험 < 30 || EXP:MASTER:A확장경험 < 4
		LOCAL:1 |= 2p4
	ELSEIF EXP:MASTER:A확장경험 < 6
		LOCAL:1 |= 1p4
	ENDIF
ENDIF

;경험 부족 레벨을 돌려준다
RETURNF MAX(COUNTBIT(LOCAL:1, 0, 3), COUNTBIT(LOCAL:1, 4, 7), COUNTBIT(LOCAL:1, 8, 11))


;-------------------------------------------------
;함수명:LUBE_INSUFF
;개  요점:윤활 부족 체크 함수
;인  수:ARG… 진정한 경우, 조수의 플레이를 판정한다
;반환값:윤활 부족 레벨. 0이라면 윤활 충분히(최대 3)
;비  고:식 안의 함수
;경험 부족의 경우, 반환값이 진(부족 레벨에 응해 1～3까지)(이)가 된다
;많이 귀찮은 만들어 하고 있지만 좋아 이대로…
;-------------------------------------------------
@LUBE_INSUFF(ARG)
#FUNCTION
#LOCALSIZE 1

;인수 부정하면 돌아온다
SIF ARG < 0
	RETURNF 0
;윤활 판정 패턴(0:판정 없음, 1:통상의 판정, 2:확장 플레이)
LOCAL = 0

;조교자에 의한 플레이를 판정
IF !ARG
	;ACT의 판정
	SELECTCASE TFLAG:ACT
		;항상 윤활 판정이 있는 플레이
		;애널애무, 짝 맞추기 놀이/가랑이 하는, 파이즈리한다, 손가락삽입해라
		;애널비즈
		;정상위, 후배위, 승마위, 대면좌위, 배면좌위, 애널섹스, 역강간
		CASE 13, 16, 17, 19, 23, 30 TO 36, 95 TO 103, 303 TO 311
			LOCAL = 1
		;도구 장착시만 윤활 판정이 있는 플레이
		;바이브, 애널바이브, 페니스밴드
		CASE 21, 22, 26
			;파생(장착)
			SIF TFLAG:ACT파생 == 0
				LOCAL = 1
		;확장 플레이(보다 많은 윤활이 필요)
		;피스트퍽, 애널피스트, 양구멍피스트
		CASE 70 TO 72
			LOCAL = 2
	ENDSELECT
	;추가행동의 판정
	SELECTCASE TFLAG:추가행동
		CASE 2, 3
			LOCAL = 1
	ENDSELECT
;조수에 의한 플레이를 판정
;실제의 체크는 애널비즈 정도 밖에 하고 있지 않지만,
;여기에서는 조교자의 플레이와 같은 체크를 한다
;즉 분위기 중시. 이론은 인정한다
ELSE
	;조수ACT의 판정
	SELECTCASE NOWASSIACTNAME(ARG)
		CASE "역강간", "애널애무", "애널로터", "애널바이브", "성교", "손가락삽입", "바이브"
			LOCAL = 1
	ENDSELECT
	;콤비 네이션의 판정
	SELECTCASE TFLAG:ACT
		CASE 303 TO 310
			LOCAL = 1
	ENDSELECT
ENDIF

;윤활의 파라미터와 로션의 나머지 효력을 체크
SELECTCASE LOCAL
	;통상의 판정
	CASE 1
		IF PALAM:MASTER:윤활 < 100 && TEQUIP:로션 < 3
			RETURNF 3
		ELSEIF PALAM:MASTER:윤활 < 250 && TEQUIP:로션 < 2
			RETURNF 2
		ELSEIF PALAM:MASTER:윤활 < 500 && TEQUIP:로션 < 1
			RETURNF 1
		ENDIF
	;확장 플레이
	CASE 2
		IF PALAM:MASTER:윤활 < 500 && TEQUIP:로션 < 3
			RETURNF 3
		ELSEIF PALAM:MASTER:윤활 < 1200 && TEQUIP:로션 < 2
			RETURNF 2
		ELSEIF PALAM:MASTER:윤활 < 2000 && TEQUIP:로션 < 1
			RETURNF 1
		ENDIF
ENDSELECT

;상에서 걸리지 않았던 경우
;윤활 충분히(또는 판정의 필요없음)
RETURNF 0


;-------------------------------------------------
;함수명:IS_UNEXTRACTION
;개  요점:질내사정시의 뽑지않고 상태 지연 판정용 함수
;인  수:ARG:0…[생략가능]뽑지않고 대상의 페니스의 소유자를 나타내는 등록 번호(현재 MASTER만)
;반환값:질내사정 타이밍에서의 뽑지않고 상태를 나타내는 수치(0~n). 1이상이라면 뽑지않고 상태에서의 질내사정
;비  고:식 안의 함수
;질내사정시에 뽑지않고 상태가 어떠한 값이었는지를 돌려준다
;만약 구상으로 사용할 수 있는 타이밍이 있다면 이사일지도
;신규 작성@revkoishi(14/06/07)
;-------------------------------------------------
@IS_UNEXTRACTION(ARG:0)
#FUNCTION
RETURNF _UNEXTRACTION(ARG:0)


;-------------------------------------------------
;함수명:_UNEXTRACTION
;개  요점:질내사정시의 뽑지않고 상태 지연 판정용 변수 보유 함수
;인  수:ARG:0…[생략가능]뽑지않고 대상의 페니스의 소유자를 나타내는 등록 번호(현재 MASTER만)
;　　　 ARG:1…[생략가능]모드. 진(1)이라면 SET, 가짜(0)라면 GET
;　　　 ARG:2…[생략가능]SET 모드의 경우 필수. 대입하는 뽑지않고 상태를 나타내는 수치(0~n). 1이상이라면 뽑지않고 상태에서의 질내사정
;반환값:질내사정 타이밍에서의 뽑지않고 상태를 나타내는 수치(0~n). 1이상이라면 뽑지않고 상태에서의 질내사정
;비  고:식 안의 함수, 내부 함수
;신규 작성@revkoishi(14/06/07)
;-------------------------------------------------
@_UNEXTRACTION(ARG:0 = -2, ARG:1, ARG:2)
#FUNCTION
ARG:0 = 0
LOCAL:(ARG:0) = ARG:1 ? ARG:2 # LOCAL:(ARG:0)
RETURNF LOCAL:(ARG:0)
