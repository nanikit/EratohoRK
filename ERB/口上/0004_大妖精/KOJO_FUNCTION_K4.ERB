;フラグ説明
;KFLAG:1	関数間貫通汎用フラグ。主に行為と反応のランダム文合わせ。
;KFLAG:2	大妖精の本気度。素質変化イベント用のフラグ。
;KFLAG:3	エンディングフラグ。


@INITIATION_K4
;調教開始時に初期化する為に呼び出される関数。主に一時変数の初期化が行われる。
;今の気分を聞く
KFLAG:100 = 8
CFLAG:1000 = 0
;自分への気持ちを聞く
KFLAG:101 = 8
CFLAG:1001 = 0
;性についての話をする
KFLAG:102 = 8
CFLAG:1002 = 0
;キス
KFLAG:115 = 8
CFLAG:1015 = 0

@CLOSETRAIN_K4
;調教終了時に呼び出される。
CFLAG:1000 = 0
CFLAG:1001 = 0
CFLAG:1002 = 0
CFLAG:1015 = 0

TALENT:臆病 = 1
TALENT:大人しい = 1

@DECIDEACTCHECK_K4
;調教主の行動決定後に呼び出される関数。調教主の行為に応じて、行動ごとに指定された変数を操作し、行動禁止フラグをON/OFFする。

;今の気分を聞くの頻度をチェック
IF TFLAG:90 == 0
	KFLAG:100 -= 5
ELSEIF TFLAG:80 == 0 && CFLAG:1000 == 0
	KFLAG:100 -= 2
ELSEIF KFLAG:100 < 8
	IF FAVOR(0, 2000)
		KFLAG:100 += (RAND:3 > 0)
	ELSE
		KFLAG:100 += 1 + RAND:2
	ENDIF
ENDIF
IF KFLAG:100 > 7
	CFLAG:1000 = 0
ELSEIF KFLAG:100 < 1
	CFLAG:1000 = 100
ENDIF

;自分への気持ちを聞くの頻度をチェック
IF TFLAG:90 == 1
	KFLAG:101 -= 5
ELSEIF TFLAG:80 == 0 && CFLAG:1000 == 0
	KFLAG:101 -= 2
ELSEIF KFLAG:101 < 8
	IF FAVOR(0, 2000)
		KFLAG:101 += (RAND:3 > 0)
	ELSE
		KFLAG:101 += 1 + RAND:2
	ENDIF
ENDIF
IF KFLAG:101 > 7
	CFLAG:1001 = 0
ELSEIF KFLAG:101 < 1
	CFLAG:1001 = 100
ENDIF

;性についての話をするの頻度をチェック
IF TFLAG:90 == 2
	KFLAG:102 -= 5
ELSEIF TFLAG:80 == 0 && CFLAG:1000 == 0
	KFLAG:102 -= 2
ELSEIF KFLAG:102 < 8
	IF FAVOR(0, 2000)
		KFLAG:102 += (RAND:3 > 0)
	ELSE
		KFLAG:102 += 1 + RAND:2
	ENDIF
ENDIF
IF KFLAG:102 > 7
	CFLAG:1002 = 0
ELSEIF KFLAG:102 < 1
	CFLAG:1002 = 100
ENDIF

;キスの頻度チェック
IF TFLAG:90 == 15
	;好感度2000未満でのキスは割と貴重
	IF FAVOR(0, 2000)
		KFLAG:115 -= 5
	ENDIF
ELSEIF KFLAG:115 < 8
	KFLAG:115 += 1
ENDIF
IF KFLAG:115 > 7
	CFLAG:1015 = 0
ELSEIF KFLAG:115 < 1
	CFLAG:1015 = 100
ENDIF

@ACTIVATION_K4
;十分な体力と気力が奴隷調教者共に保証されているときに、素質[臆病][大人しい]を失う
PRINTL  
IF RAND:3 == 0
	PRINTFORMDW 大妖精は張り切っている……
ELSEIF RAND:2
	IF FAVOR(0, 2000)
		PRINTFORMDW 大妖精は楽しそうだ……
	ELSE
		PRINTFORMDW 大妖精は覚悟を決めたような眼差しで%CALLNAME:MASTER%を見据える……
	ENDIF
ELSE
	IF FAVOR(0, 2000)
		PRINTFORMDW 大妖精は嬉々とした表情で悪戯を続ける……
	ELSE
		PRINTFORMDW 大妖精は堪え切れない悪戯への欲望から体をもじもじと震わせている……
	ENDIF
ENDIF
IF FIRSTTIME(1000)
	PRINTL  
	PRINTFORMDW ※一時的に調教者が素質[臆病][大人しい]を失います（以降この文は表示されません）
ENDIF
TALENT:臆病 = 0
TALENT:大人しい = 0
PRINTL  

@CALMING_K4
;お互いの内どちらかでも体力、気力がヤバくなってきたら、[臆病][大人しい]を得て省エネモードに入る
PRINTL  
IF (BASE:0 * 100) / MAXBASE:0 < 25
	PRINTFORMDW 大妖精は消耗している……少し落ち着くことにしたようだ……
ELSEIF RAND:3 == 0
	PRINTFORMDW 大妖精は少しはしゃぎすぎてしまったと思ったのか自制をかけている……
ELSEIF RAND:2
	IF FAVOR(0, 2000)
		PRINTFORMDW 大妖精は%CALLNAME:MASTER%を労わり、優しくそっと体を撫で擦り始めた……
	ELSE
		PRINTFORMDW 大妖精は%CALLNAME:MASTER%を労わることにしたようだ……
	ENDIF
ELSE
	IF FAVOR(0, 2000)
		PRINTFORMDW 大妖精は%CALLNAME:MASTER%の消耗ぶりをみて自身の行いを猛省し、慈愛の表情を浮かべて心身を癒そうとしている……
	ELSE
		PRINTFORMDW 大妖精は%CALLNAME:MASTER%にしてきた仕打ちを思い返して、少し反省したようだ……
	ENDIF
ENDIF
IF FIRSTTIME(1001)
	PRINTL  
	PRINTFORMDW ※一時的に失っていた調教者の素質、[臆病][大人しい]が復帰します（以降この文は表示されません）
ENDIF
TALENT:臆病 = 1
TALENT:大人しい = 1
PRINTL  

@FADEIO(ARG = 4, ARGS = "VOID", ARGS:1 = "VOID", ARGS:2 = "VOID", ARGS:3 = "VOID", ARGS:4 = "VOID", ARGS:5 = "VOID", ARGS:6 = "VOID", ARGS:7 = "VOID", ARGS:8 = "VOID", ARGS:9 = "VOID", ARGS:10 = "VOID", ARGS:11 = "VOID", ARGS:12 = "VOID", ARGS:13 = "VOID", ARGS:14 = "VOID", ARGS:15 = "VOID", ARGS:16 = "VOID", ARGS:17 = "VOID", ARGS:18 = "VOID", ARGS:19 = "VOID", ARGS:20 = "VOID", ARGS:21 = "VOID", ARGS:22 = "VOID", ARGS:23 = "VOID", ARGS:24 = "VOID", ARGS:25 = "VOID", ARGS:26 = "VOID", ARGS:27 = "VOID", ARGS:28 = "VOID", ARGS:29 = "VOID")
;指定された文字列をフェードインしてフェードアウトし、行を削除する。
;色は設定されたものを用いる
;引数はフェードインと一緒
CALL FADEIN(ARG, ARGS, ARGS:1, ARGS:2, ARGS:3, ARGS:4, ARGS:5, ARGS:6, ARGS:7, ARGS:8, ARGS:9, ARGS:10, ARGS:11, ARGS:12, ARGS:13, ARGS:14, ARGS:15, ARGS:16, ARGS:17, ARGS:18, ARGS:19, ARGS:20, ARGS:21, ARGS:22, ARGS:23, ARGS:24, ARGS:25, ARGS:26, ARGS:27, ARGS:28, ARGS:29)
CLEARLINE 1
CALL FADEOUT(ARG, ARGS, ARGS:1, ARGS:2, ARGS:3, ARGS:4, ARGS:5, ARGS:6, ARGS:7, ARGS:8, ARGS:9, ARGS:10, ARGS:11, ARGS:12, ARGS:13, ARGS:14, ARGS:15, ARGS:16, ARGS:17, ARGS:18, ARGS:19, ARGS:20, ARGS:21, ARGS:22, ARGS:23, ARGS:24, ARGS:25, ARGS:26, ARGS:27, ARGS:28, ARGS:29)
CLEARLINE 1

@FADEIOD(ARG = 4, ARGS = "VOID", ARGS:1 = "VOID", ARGS:2 = "VOID", ARGS:3 = "VOID", ARGS:4 = "VOID", ARGS:5 = "VOID", ARGS:6 = "VOID", ARGS:7 = "VOID", ARGS:8 = "VOID", ARGS:9 = "VOID", ARGS:10 = "VOID", ARGS:11 = "VOID", ARGS:12 = "VOID", ARGS:13 = "VOID", ARGS:14 = "VOID", ARGS:15 = "VOID", ARGS:16 = "VOID", ARGS:17 = "VOID", ARGS:18 = "VOID", ARGS:19 = "VOID", ARGS:20 = "VOID", ARGS:21 = "VOID", ARGS:22 = "VOID", ARGS:23 = "VOID", ARGS:24 = "VOID", ARGS:25 = "VOID", ARGS:26 = "VOID", ARGS:27 = "VOID", ARGS:28 = "VOID", ARGS:29 = "VOID")
;設定された文字列をフェードインしてフェードアウトし、行を削除する。
;色はデフォルトの色を用いる
;引数はフェードインと一緒
LOCAL = GETCOLOR()
SETCOLOR GETDEFCOLOR()
CALL FADEIO(ARG, ARGS, ARGS:1, ARGS:2, ARGS:3, ARGS:4, ARGS:5, ARGS:6, ARGS:7, ARGS:8, ARGS:9, ARGS:10, ARGS:11, ARGS:12, ARGS:13, ARGS:14, ARGS:15, ARGS:16, ARGS:17, ARGS:18, ARGS:19, ARGS:20, ARGS:21, ARGS:22, ARGS:23, ARGS:24, ARGS:25, ARGS:26, ARGS:27, ARGS:28, ARGS:29)
SETCOLOR LOCAL

@FADEIND(ARG = 4, ARGS = "VOID", ARGS:1 = "VOID", ARGS:2 = "VOID", ARGS:3 = "VOID", ARGS:4 = "VOID", ARGS:5 = "VOID", ARGS:6 = "VOID", ARGS:7 = "VOID", ARGS:8 = "VOID", ARGS:9 = "VOID", ARGS:10 = "VOID", ARGS:11 = "VOID", ARGS:12 = "VOID", ARGS:13 = "VOID", ARGS:14 = "VOID", ARGS:15 = "VOID", ARGS:16 = "VOID", ARGS:17 = "VOID", ARGS:18 = "VOID", ARGS:19 = "VOID", ARGS:20 = "VOID", ARGS:21 = "VOID", ARGS:22 = "VOID", ARGS:23 = "VOID", ARGS:24 = "VOID", ARGS:25 = "VOID", ARGS:26 = "VOID", ARGS:27 = "VOID", ARGS:28 = "VOID", ARGS:29 = "VOID")
;設定された文字列をフェードインする。
;色はデフォルトの色を用いる
;引数はフェードインと一緒
LOCAL = GETCOLOR()
SETCOLOR GETDEFCOLOR()
CALL FADEIN(ARG, ARGS, ARGS:1, ARGS:2, ARGS:3, ARGS:4, ARGS:5, ARGS:6, ARGS:7, ARGS:8, ARGS:9, ARGS:10, ARGS:11, ARGS:12, ARGS:13, ARGS:14, ARGS:15, ARGS:16, ARGS:17, ARGS:18, ARGS:19, ARGS:20, ARGS:21, ARGS:22, ARGS:23, ARGS:24, ARGS:25, ARGS:26, ARGS:27, ARGS:28, ARGS:29)
SETCOLOR LOCAL
